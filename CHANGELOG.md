# Changelog

## v1.8.0-rc4

Summary of Changes
------------------

**Minor Changes:**
* api/v1: Add observation proto enum (Backport PR #12173, Upstream PR #12085, @glibsm)
* docs: Extend BPF-based masquerading section (Backport PR #12203, Upstream PR #12145, @brb)
* helm: Remove affinity from cilium-etcd-operator (Backport PR #12173, Upstream PR #12139, @brb)
* Update the Cilium eBPF library to the latest version. (Backport PR #12103, Upstream PR #12068, @tklauser)

**Bugfixes:**
* bpf: Use `nproc --all` for `__NR_CPUS__` (Backport PR #12173, Upstream PR #12121, @gandro)
* cilium-operator: Wait for CRDs before running Informers (Backport PR #12173, Upstream PR #10899, @mrostecki)
* cilium/charts: set system-{node,cluster}-critical priorityClass for k8s >= 1.17 (Backport PR #12173, Upstream PR #12151, @aanm)
* cilium: chaining mode skb->mark can be mangled by iptables allow opt-out (Backport PR #12196, Upstream PR #12185, @jrfastab)
* cilium: fix helm usage of enableIdentityMap -> enableIdentityMark (Backport PR #12196, Upstream PR #12194, @jrfastab)
* daemon: Fix fallback to iptables-based masquerading (Backport PR #12103, Upstream PR #12081, @brb)
* daemon: fix panic when starting Cilium (Backport PR #12173, Upstream PR #12101, @aanm)
* daemon: Fix session affinity map creation (Backport PR #12173, Upstream PR #12134, @brb)
* datapath,daemon: Fix initialization panics when IPv6 is enabled (Backport PR #12203, Upstream PR #12197, @brb)
* do not ignore Kubernetes event updates for CCNP and CNP with 'specs' field after being created (Backport PR #12173, Upstream PR #12143, @aanm)
* doc: Ensure ConfigMap remains compatible across 1.7 -> 1.8 upgrade (Backport PR #12173, Upstream PR #12097, @tgraf)
* Don't require (not supported on Azure) ipam.Cidrs when masquerade is disabled (Backport PR #12103, Upstream PR #11978, @bpineau)
* operator: sync CiliumNodes into etcd instead of k8s nodes (Backport PR #12173, Upstream PR #12179, @aanm)
* option: Require native-routing-cidr only if IPv4 is enabled (Backport PR #12203, Upstream PR #12198, @brb)
* stop Cilium from hanging on CNP or CCNP events from Kubernetes if running with 'k8s-event-handover=true' and 'kvstore=""' (Backport PR #12173, Upstream PR #12146, @aanm)

**CI Changes:**
* add missing hook in misc unit tests (Backport PR #12203, Upstream PR #12122, @aanm)
* Add quarantine mechanism to test suite (Backport PR #12103, Upstream PR #11981, @nebril)
* test,daemon: Fix repeated devices (Backport PR #12196, Upstream PR #12176, @brb)
* test: Add generated files to .gitignore, avoid pulling stale images. (Backport PR #12173, Upstream PR #12110, @jrajahalme)
* test: Download correct cilium-istioctl for the executing OS. (Backport PR #12173, Upstream PR #12109, @jrajahalme)
* test: fix cli flags handling (Backport PR #12173, Upstream PR #12099, @nebril)
* test: Fix typo (Backport PR #12173, Upstream PR #12090, @jrajahalme)
* test: Skip Istio test if Ginkgo runs on unsupported runtime. (Backport PR #12173, Upstream PR #11905, @jrajahalme)

**Misc Changes:**
* 1.8 documentation updates: Concepts & menu structure (Backport PR #12173, Upstream PR #11979, @tgraf)
* Add command-line instructions to install the hubble CLI (Backport PR #12103, Upstream PR #12001, @michi-covalent)
* Add Hubble store getter to gain access to k8s data store. (Backport PR #12173, Upstream PR #12114, @lzang)
* Add policy verdicts GSG (Backport PR #12196, Upstream PR #12165, @joestringer)
* contrib: Add environment variable to script  to control K8s namespace (Backport PR #12103, Upstream PR #12082, @christarazi)
* contrib: Misc. fixups for k8s-cilium-exec.sh script (Backport PR #12173, Upstream PR #12126, @christarazi)
* daemon: Enable device auto detection for host-fw when BPF NodePort is disabled (Backport PR #12103, Upstream PR #12050, @brb)
* daemon: Warn when policy audit mode is enabled (Backport PR #12173, Upstream PR #12166, @joestringer)
* doc: add Networking and security observability with Hubble guide (Backport PR #12173, Upstream PR #12155, @michi-covalent)
* doc: ensure to use --set config.ipam=kubernetes with kind (Backport PR #12196, Upstream PR #12181, @Rolinh)
* doc: Misc fixups for Transparent Encryption GSG (Backport PR #12173, Upstream PR #12088, @christarazi)
* doc: revamp kata containers getting started guide (Backport PR #12203, Upstream PR #12144, @Rolinh)
* doc: Specify `CILIUM_NAMESPACE` for Hubble installation instruction (Backport PR #12173, Upstream PR #12149, @michi-covalent)
* docs: Add IP fragmentation tracking section (Backport PR #12203, Upstream PR #12162, @joestringer)
* docs: Add note about `--node-ip` kubelet option (Backport PR #12103, Upstream PR #12095, @gandro)
* docs: adjust to new mapDynamicSizeRatio default in upgrade guide (Backport PR #12103, Upstream PR #12065, @tklauser)
* docs: consolidate BPF map documentation in concepts/ebpf/intro.rst (Backport PR #12173, Upstream PR #12183, @tklauser)
* docs: Extend kubeproxy-free GSG wrt multi-dev (Backport PR #12103, Upstream PR #12054, @brb)
* docs: fix line-break in parsed-literal instance (Backport PR #12173, Upstream PR #12157, @borkmann)
* docs: fix `SCM_WEB` expansion in troubleshooting guide (Backport PR #12103, Upstream PR #12096, @tklauser)
* docs: Host firewall documentation (Backport PR #12203, Upstream PR #12187, @pchaigno)
* docs: Improve consistency in Azure docs (Backport PR #12173, Upstream PR #12108, @errordeveloper)
* docs: mention disabling of lro on `hv_netvsc` (Backport PR #12173, Upstream PR #12172, @borkmann)
* docs: NodePort XDP on AWS (Backport PR #12173, Upstream PR #12156, @borkmann)
* docs: NodePort XDP on Azure (Backport PR #12173, Upstream PR #12150, @gandro)
* docs: simplify one of the steps in GKE guide (Backport PR #12173, Upstream PR #12148, @errordeveloper)
* docs: update example output in HTTP-aware policy enforcement GSG (Backport PR #12103, Upstream PR #12069, @tklauser)
* docs: update on hostport for upgrade guide and cni chanining (Backport PR #12103, Upstream PR #12066, @borkmann)
* Fix commands in EKS kube-proxy free GSG (Backport PR #12173, Upstream PR #12174, @tklauser)
* Fix GKE Helm options for CI and docs. (Backport PR #12196, Upstream PR #12087, @jrajahalme)
* Fix native routing cidr missing flag in daemon (Backport PR #12173, Upstream PR #12180, @aanm)
* Ginkgo: Simplify all --focus regexes (Backport PR #12173, Upstream PR #12089, @jrajahalme)
* helm: Clean up the hubble-relay DNS name in the UI chart (Backport PR #12173, Upstream PR #12033, @michi-covalent)
* Minor BIRD guide improvements (Backport PR #12103, Upstream PR #12092, @joestringer)
* Misc 1.8 upgrade docs fixups (Backport PR #12103, Upstream PR #12083, @joestringer)
* pkg/k8s: ignore status field in CNP DeepEqual (Backport PR #12173, Upstream PR #12171, @aanm)
* Revert "test: disable fqdn restart test" (Backport PR #12103, Upstream PR #11929, @jrajahalme)
* test: Fix hubble-relay image helm path (Backport PR #12173, Upstream PR #12076, @jrajahalme)
* test: Fix nativeRoutingCIDR in CI (Backport PR #12196, Upstream PR #12190, @joestringer)
* test: Remove ginkgo linux dependency (Backport PR #12103, Upstream PR #12074, @jrajahalme)
* test: Scrub GKE cluster more thoroughly when releasing cluster. (Backport PR #12203, Upstream PR #12192, @jrajahalme)
* test: Set devices and enable host firewall in kube-proxy CI (Backport PR #12173, Upstream PR #11969, @pchaigno)
* testing: final conversion 4.19 CI to kube-proxy free (Backport PR #12103, Upstream PR #12045, @borkmann)
* Tidy & expand policy docs (Backport PR #12173, Upstream PR #12164, @joestringer)
* Update xargs usage in restart-pods documentation (Backport PR #12103, Upstream PR #12064, @ap4y)
* Use right schema when validating CCNP in pre-flight upgrade step (Backport PR #12173, Upstream PR #12106, @aanm)

## v1.8.0-rc3

Note: The summary of changes represents the diff between v1.8.0-rc2 and v1.8.0-rc3

Summary of Changes
------------------

**Major Changes:**
* Add scalability report of Cilium on large clusters in CRD mode (Backport PR #11856, Upstream PR #11760, @aanm)

**Minor Changes:**
* Azure: support non VMSS instances (Backport PR #12027, Upstream PR #11571, @bpineau)
* cilium: fix up all --help sections properly (Backport PR #12027, Upstream PR #11007, @soumynathan)
* connectivity-check: Do not perform hostport in standard check (Backport PR #11856, Upstream PR #11715, @tgraf)
* daemon: Allow to fallback to iptables-based masquerading and friends (Backport PR #12039, Upstream PR #12026, @brb)
* daemon: Clarify log msg how to use only TCP socket-lb (Backport PR #11926, Upstream PR #11918, @brb)
* daemon: Fix detection of BPF/XDP NodePort, BPF masq and host-fw devices (Backport PR #12027, Upstream PR #11894, @brb)
* docker: add hubble CLI binary to the base cilium image (Backport PR #11856, Upstream PR #11784, @Rolinh)
* Envoy is updated to release 1.13.2. (Backport PR #12027, Upstream PR #11973, @jrajahalme)
* grafana: Add Hubble dashboard (Backport PR #12039, Upstream PR #12004, @gandro)
* helm: added global.logOptions parameter (Backport PR #12039, Upstream PR #11861, @mvisonneau)
* Implement per-provider operator deployments in Helm (Backport PR #12039, Upstream PR #12029, @joestringer)
* Remove deprecated --flannel-manage-existing-containers option (Backport PR #12027, Upstream PR #12008, @tklauser)
* test: Do not set tty for preloaded VM (Backport PR #11926, Upstream PR #11877, @jrajahalme)
* test: set hubble-relay image in helm defaults if available (Backport PR #11926, Upstream PR #11904, @jrajahalme)

**Bugfixes:**
* Add anti-affinity for Cilium pods to prevent 2 pods being executed on the same node at the same time (Backport PR #11893, Upstream PR #11830, @nebril)
* Autodetection of the mtu correctly detects the mtu of the interface used for the kubernetes cluster communication. The mtu was incorrectly detected in cases where multiple interfaces were present and the gateway interface was not the one used for kubernetes cluster communication (Backport PR #11893, Upstream PR #10635, @manuelbuil)
* Avoid duplication of generated toCIDRs when using a toServices based CNP (or CCNP) (Backport PR #11926, Upstream PR #11901, @aanm)
* cilium: fix encryption flow labels in ip6 case (Backport PR #12039, Upstream PR #12015, @jrfastab)
* datapath: Accept proxy traffic if enable-endpoint-routes are enabled (Backport PR #11856, Upstream PR #11819, @tgraf)
* datapath: Only NOTRACK proxy return traffic going to Cilium datapath (Backport PR #11937, Upstream PR #11899, @jrajahalme)
* endpoint: Fix data races while accessing GetIdentity() (Backport PR #11984, Upstream PR #11941, @tgraf)
* eni: Fix potential deadlock (Backport PR #11856, Upstream PR #11831, @christarazi)
* Fix datarace issue in spanstat.go (Backport PR #11856, Upstream PR #11615, @sayboras)
* Fix issue when Cilium randomly stops doing service translation in k8s 1.18 (Backport PR #12027, Upstream PR #11947, @aanm)
* Fix leaking endpoint state metric (Backport PR #11937, Upstream PR #11884, @christarazi)
* Fix setting monitorAggregationLevel to max reflects via CLI (Backport PR #12039, Upstream PR #12014, @soumynathan)
* fix transparent encryption related bugs (Backport PR #12027, Upstream PR #11974, @jrfastab)
* Fix tunneling and ARP resolution when host firewall is enabled. (Backport PR #11893, Upstream PR #11795, @pchaigno)
* hubble/peer: handle burst of change notifications (Backport PR #12039, Upstream PR #12024, @Rolinh)
* ipcache: Fix deadlock when ipcache GC results in datapath reload (Backport PR #11984, Upstream PR #11950, @tgraf)
* loader: Fix tunneling when device is set without NodePort (Backport PR #12027, Upstream PR #11980, @pchaigno)
* nodeinit: Fix for restarting kubenet managed pods (Backport PR #11856, Upstream PR #11779, @dctrwatson)
* Properly cancel endpoint creations as they become obsolete (Backport PR #11951, Upstream PR #11920, @tgraf)
* proxy: Keep DNS port allocated (Backport PR #11856, Upstream PR #11661, @jrajahalme)
* Remove default bpf map size values for new installations and use the dynamic calculation based on system's memory. (Backport PR #12039, Upstream PR #11991, @aanm)
* service: Fix wrong localEndpoints count in HealthCheckNodePort (Backport PR #11893, Upstream PR #11863, @gandro)

**CI Changes:**
* .travis: disable Documentation building on ARM64 (Backport PR #12039, Upstream PR #12043, @Jianlin-lv)
* ci: Change vagrant timeout mechanism (Backport PR #11893, Upstream PR #11858, @nebril)
* CI: fix bash complaining about "unexpected tokens" (parenthesis) (Backport PR #11937, Upstream PR #11307, @qmonnet)
* ci: fix timeout vagrant up timeout (Backport PR #11856, Upstream PR #11798, @nebril)
* ci: make docker images in ghaction (Backport PR #11893, Upstream PR #11693, @nebril)
* ci: outer vm boot timeout was smaller than inner (Backport PR #11856, Upstream PR #11758, @nebril)
* ci: retry docker build in jenkins (Backport PR #11856, Upstream PR #11796, @nebril)
* ci: run lscpu at end of build (Backport PR #11856, Upstream PR #11814, @nebril)
* ci: various gke script fixes (Backport PR #11926, Upstream PR #11864, @nebril)
* cilium, test: Only run sockops tests on 4.19 and bpf-next kernels (Backport PR #12027, Upstream PR #11998, @jrfastab)
* daemon: cancel daemon context on TearDownTest (Backport PR #11893, Upstream PR #11870, @aanm)
* Docs: update backport commands for jenkins builds (Backport PR #11893, Upstream PR #11860, @nebril)
* eni: Fix node manager test (Backport PR #11856, Upstream PR #11773, @errordeveloper)
* Fix flaky assertion on metrics (Backport PR #11984, Upstream PR #11966, @christarazi)
* ginkgo-ext: Fix data-race in Writer (Backport PR #12039, Upstream PR #12025, @gandro)
* test/helpers: allow passing custom number of requests to helpers.Ping() (Backport PR #11937, Upstream PR #11897, @qmonnet)
* test/k8s: keep configmap across upgrade test (Backport PR #12039, Upstream PR #12051, @aanm)
* test/K8sServices: disable fragment tracking test for kernel 4.19 (Backport PR #12039, Upstream PR #12041, @qmonnet)
* test/K8sServices: Skip checks for externalTrafficPolicy=Local with kube-proxy <1.15 (Backport PR #11951, Upstream PR #11965, @gandro)
* test: Add debugging info for potential flakes in NodePort services tests with L4 and L7 (Backport PR #12027, Upstream PR #11765, @jrajahalme)
* test: Add retries to curl command (Backport PR #12027, Upstream PR #11993, @christarazi)
* test: add retries to expected successful curl calls (Backport PR #11893, Upstream PR #11797, @nebril)
* test: Add simple retries for flaky Helm operations (Backport PR #11856, Upstream PR #11762, @christarazi)
* test: disable fqdn restart test (Backport PR #11856, Upstream PR #11776, @nebril)
* test: Fix and re-enable test reliant on managed etcd (Backport PR #11856, Upstream PR #11818, @errordeveloper)
* test: Gather combined Cilium logs as last resort (Backport PR #12027, Upstream PR #12007, @nebril)
* test: retry fqdn requests, increase curl timeout (Backport PR #11856, Upstream PR #11775, @nebril)
* test: use local copy of Cilium Star Wars Demo (Backport PR #11856, Upstream PR #11817, @tklauser)
* test: Wait for IPCache entries in testSessionAffinity (Backport PR #11856, Upstream PR #11771, @brb)
* test: Wait for POD policy revision increment in all cases. (Backport PR #12027, Upstream PR #11995, @jrajahalme)

**Misc Changes:**
* 1.8 Documentation updates (Backport PR #11926, Upstream PR #11892, @tgraf)
* Add audit action to the policy verdict log (Backport PR #11893, Upstream PR #11843, @ap4y)
* Add connectivity test to troubleshooting (Backport PR #11856, Upstream PR #11643, @jedsalazar)
* agent: Fix data race when accessing d.monitorAgent (Backport PR #11856, Upstream PR #11823, @tgraf)
* azure/ipam: Fix nil dereference with logger (Backport PR #11856, Upstream PR #11786, @christarazi)
* bpf, docs: add list of XDP supported drivers (Backport PR #11984, Upstream PR #11970, @borkmann)
* bpf: enable hairpin optimizations to avoid fib lookup also for tc (Backport PR #12027, Upstream PR #11989, @borkmann)
* bpf: Fix race when accessing m.fd (Backport PR #11856, Upstream PR #11812, @tgraf)
* bpf: more scalability improvements (Backport PR #11856, Upstream PR #11694, @borkmann)
* bpf: split off debug options and do not run it in ci (Backport PR #12039, Upstream PR #11977, @borkmann)
* bpf: various datapath follow-up optimisations and fixes (Backport PR #11984, Upstream PR #11924, @borkmann)
* cilium: downgrade kernel_hz clock probe warning to info message (Backport PR #11856, Upstream PR #11816, @borkmann)
* cilium: rename --node-port-acceleration=none to =disabled (Backport PR #11951, Upstream PR #11925, @borkmann)
* cocci: Detect unlogged missed tail calls (Backport PR #11893, Upstream PR #11808, @pchaigno)
* contrib/backporting: remove requires-janitor-review label (Backport PR #12039, Upstream PR #11986, @aanm)
* contrib: Fix submit-backport PR set-labels detection (Backport PR #11926, Upstream PR #11912, @joestringer)
* daemon/cli: Add SessionAffinity to cilium status (Backport PR #11951, Upstream PR #11927, @brb)
* daemon: Remove checkHostFirewallWithEgressLB() (Backport PR #12027, Upstream PR #11982, @pchaigno)
* datapath: Silent iptables removal on first init (Backport PR #11856, Upstream PR #11815, @tgraf)
* doc: add "observing flows with Hubble Relay" to troubleshooting section (Backport PR #11937, Upstream PR #11919, @Rolinh)
* doc: fix up GKE install guide (Backport PR #11984, Upstream PR #11960, @Rolinh)
* doc: Troubleshooting with Hubble (Backport PR #11893, Upstream PR #11827, @gandro)
* doc: uniformize name when referring to Hubble Relay (Backport PR #11937, Upstream PR #11923, @Rolinh)
* doc: Update the EKS getting started guide (Backport PR #11893, Upstream PR #11697, @michi-covalent)
* doc: Update the Hubble section of getting started guides (Backport PR #12027, Upstream PR #11882, @michi-covalent)
* doc: Use --reuse-values option for helm upgrade (Backport PR #12027, Upstream PR #12020, @michi-covalent)
* docs/scalability: set right ipam option (Backport PR #11926, Upstream PR #11890, @aanm)
* docs: Add Hubble metrics reference (Backport PR #12027, Upstream PR #11996, @gandro)
* docs: Add session affinity to kubeproxy-free guide (Backport PR #11984, Upstream PR #11957, @brb)
* docs: add word to misspelled list (Backport PR #11856, Upstream PR #11822, @aanm)
* docs: Consolidate bpf-map-dynamic-size-ratio documentation (Backport PR #12039, Upstream PR #12028, @tklauser)
* docs: Improve session affinity section in kube-proxy free guide (Backport PR #11984, Upstream PR #11958, @brb)
* docs: Include directions to restart pods in the k3s install guide (Backport PR #11893, Upstream PR #11879, @seanmwinn)
* docs: k3s command missing `sh -` (Backport PR #11926, Upstream PR #11878, @glibsm)
* docs: Parameterize READTHEDOCS_VERSION (Backport PR #11856, Upstream PR #11840, @joestringer)
* docs: point cilium docs into a stable version of sphinx theme (Backport PR #12032, Upstream PR #12010, @genbit)
* docs: quote helm flags with brackets (Backport PR #11984, Upstream PR #11922, @nebril)
* docs: re-design cilium docs theme (Backport PR #12032, Upstream PR #11803, @genbit)
* docs: Remove redundant stable release instructions (Backport PR #11926, Upstream PR #11898, @joestringer)
* docs: Rework live-preview to use docker container (Backport PR #11951, Upstream PR #11940, @joestringer)
* Ensure endpoint validation occurs before initial regeneration (Backport PR #11856, Upstream PR #11714, @tgraf)
* envoy: Include detail in NACK warning (Backport PR #12027, Upstream PR #12016, @jrajahalme)
* etcd: propagate Context from higher-level calls (Backport PR #12027, Upstream PR #11891, @tklauser)
* Fix live preview with Python 3.8 (Backport PR #11893, Upstream PR #11838, @joestringer)
* Fix missing operator-generic in upstream k8s tests (Backport PR #12039, Upstream PR #12055, @aanm)
* fix(datarace): Fix possible nil pointer dereference (Backport PR #11856, Upstream PR #11804, @sayboras)
* fqdn: Fix missing IsNil checks in unit tests (Backport PR #11984, Upstream PR #11953, @pchaigno)
* helm: added global.cni.readCniConf parameter (Backport PR #12039, Upstream PR #11597, @mvisonneau)
* helm: Bump hubble-ui to v0.6.0 (Backport PR #11893, Upstream PR #11854, @gandro)
* helm: fixed hubble servicemonitor matchLabels parameter (Backport PR #11926, Upstream PR #11886, @mvisonneau)
* helm: Generate experimental-install.yaml (Backport PR #11984, Upstream PR #11907, @michi-covalent)
* helm: Simplify Hubble metrics values (Backport PR #11926, Upstream PR #11887, @gandro)
* helm: Use port 80 for service/hubble-ui (Backport PR #12027, Upstream PR #12023, @gandro)
* hubble/observer: increment 'numObservedFlows' atomically (Backport PR #11856, Upstream PR #11835, @aanm)
* hubble: enable metrics before starting server (Backport PR #11893, Upstream PR #11846, @aanm)
* Implement values for hubble-relay to properly control sub chart values (Backport PR #12027, Upstream PR #11757, @seanmwinn)
* install: Fix up version/pullPolicy for multiple values files (Backport PR #12027, Upstream PR #12030, @joestringer)
* iptables: carry on and log on failure to set up transient rules (Backport PR #12027, Upstream PR #12006, @qmonnet)
* k8s: Fix data race when setting node address (Backport PR #11893, Upstream PR #11851, @tgraf)
* loader: Attach bpf_host to cilium_net from Golang (Backport PR #11856, Upstream PR #11598, @pchaigno)
* logo: change SVG file used for the logo (Backport PR #12032, Upstream PR #12002, @qmonnet)
* Misc docs index & development section improvements (Backport PR #11856, Upstream PR #11839, @joestringer)
* nodeinit: Use newly built image (Backport PR #11893, Upstream PR #11876, @errordeveloper)
* pkg/clustermesh: protect tests against concurrent access (Backport PR #11893, Upstream PR #11852, @aanm)
* pkg/identity: protect LabelsSHA256 against concurrent initializations (Backport PR #11893, Upstream PR #11872, @aanm)
* pkg/ipcache: create a GetK8sMetadata for public access (Backport PR #11856, Upstream PR #11833, @aanm)
* pkg/k8s: decrease CEP status initialization (Backport PR #11893, Upstream PR #11829, @aanm)
* pkg/k8s: use node name from pkg/node instead of env variable (Backport PR #11856, Upstream PR #11834, @aanm)
* policy: Fix enforcement status for host endpoint (Backport PR #11856, Upstream PR #11759, @pchaigno)
* policy: Fix rule translation test flake (Backport PR #11926, Upstream PR #11913, @joestringer)
* release: Improve documentation around release process (Backport PR #12039, Upstream PR #11939, @joestringer)
* Remove hubble-cli sub-chart (Backport PR #11856, Upstream PR #11806, @seanmwinn)
* runtime: Update LLVM image (Backport PR #11984, Upstream PR #11968, @errordeveloper)
* service: Clean up HealthCheckNodePort server when traffic policy changes (Backport PR #11984, Upstream PR #11952, @gandro)
* test: Disable flaky RuntimeKVStoreTest tests (Backport PR #11984, Upstream PR #11945, @pchaigno)
* test: Fix NodePort acceleration param (Backport PR #11951, Upstream PR #11942, @brb)
* Update ENI limits list (Backport PR #11893, Upstream PR #11793, @bpineau)
* Update Go to 1.14.4 (Backport PR #11856, Upstream PR #11811, @tklauser)
* vagrant: bump net-next vagrant box version (Backport PR #11951, Upstream PR #11917, @borkmann)
* vagrant: Fix make in net-next dev. VM (Backport PR #12027, Upstream PR #11987, @pchaigno)

## v1.8.0-rc2

Note: The summary of changes represents the diff between v1.8.0-rc1 and v1.8.0-rc2

Summary of Changes
------------------

**Major Changes:**
* bpf: getpeername hook implementation for socket lb (#11617, @borkmann)

**Minor Changes:**
* Accessing a NodePort service via cilium_host IP addr is no longer recommended. (#11692, @brb)
* Add "--iptables-lock-timeout" to configure iptables --wait parameter (#11701, @joestringer)
* datapath: Enable session affinity for older kernels (#11678, @brb)
* doc: Update LLVM/Clang requirement to 10.0 (#11686, @pchaigno)
* Expose BPF kernel memory usage as a prometheus metric (#11682, @aanm)
* operator: Ship slimmer binaries (#10972, @errordeveloper)
* Remove netstat from cilium-bugtool and replace with ss tool (#11667, @soumynathan)
* Updated grafana dashboard (#11744, @aanm)

**Bugfixes:**
* Allow enabling ServiceMonitor without Prometheus installed. (#11261, @diversario)
* azure: fix excess/off-by-one addresses allocation (#11669, @bpineau)
* cilium-cni: Only start gops in debug mode (#11711, @aanm)
* datapath: Fix back-edge in bpf_sock for older kernels (#11739, @brb)
* etcd: Increase status check timeout to 10 seconds (#11750, @tgraf)
* Fix Cilium blocking its initialization for nodes where the hostname was different that the Kubernetes node name. (#11717, @aanm)
* Fix issue where Cilium-agent fails to start on nodes without a default gateway (#11632, @soumynathan)
* Fix issue where traffic from a pod could be dropped despite allow policy when DNS L7 rules are used (#11764, @joestringer)
* hubble/parser/threefour: handle IPv6 CIDR labels (#11719, @Rolinh)
* Hubble: fix unknown identities for some CIDR (#11703, @Rolinh)
* operator: fix panic for non existing CEPs (#11749, @aanm)
* Protect ENI and Azure IPAM from misbehaving cloud APIs (#11231, @tgraf)
* proxy: Do not decrement proxy port reference count when reverting. (#11753, @jrajahalme)
* proxy: Keep DNS port allocated (#11661, @jrajahalme)

**CI Changes:**
* ci/K8sHubble: Retry failed requests on hubble-relay (#11708, @gandro)
* ci: Check whether pod is being terminated before deleting it (#11655, @nebril)
* ci: Fix focus handling in ginkgo-ext (#11534, @nebril)
* ci: fix gke cluster lock (#11712, @nebril)
* ci: outer vm boot timeout was smaller than inner (#11758, @nebril)
* ci: remove nightly image build (#11674, @nebril)
* Correct prometheus template in integration test (#11611, @sayboras)
* helpers: Remove hubble-relay service in cleanup (#11721, @gandro)
* Run precheck make target in Travis CI (#11740, @tklauser)
* test(helm): Correct invalid input in kind-action (#11704, @sayboras)
* test/k8s: Migrate L7 visibility tests to hubble (#11622, @glibsm)
* test/k8sHubble: Clean up hubble-cli and hubble-relay pods (#11687, @gandro)
* test/K8sServices: redeploy Cilium before fragment tracking tests (#11663, @qmonnet)
* test: Add externalIPs tests to K8sServicesTest and disable K8sKubeProxyFreeMatrix (#11696, @brb)
* test: Aid flake debugging (#11520, @errordeveloper)
* test: disable "Tests NodePort with L7 Policy" (#11710, @nebril)
* test: Fix issue with unmanaged pod deletions hitting the timeout (#11654, @errordeveloper)
* test: force restarting of Cilium pods (#11613, @nebril)
* test: Improve K8sServicesTest naming and expectation offsets (#11675, @brb)
* test: increase timeout for getting pod list for logs (#11747, @nebril)
* test: Mend gingko-ext (#11553, @errordeveloper)
* test: parallelize log gathering (#11748, @nebril)
* test: retry fqdn requests, increase curl timeout (#11775, @nebril)
* test: use pkg/lock instead of stdlib sync (#11729, @tklauser)
* test: Wait for IPCache entries in testSessionAffinity (#11771, @brb)
* travis: fix arm64 build (#11774, @tklauser)

**Misc Changes:**
* Allow to create docker images with unstripped binaries (#11689, @tklauser)
* bpf: fix test/bpf/unit-test segfault due to memcmp looping (#11709, @borkmann)
* bpf: optimized memmove for XDP + DSR (#11676, @borkmann)
* bump k8s dependencies and test to v1.18.3 (#11679, @aanm)
* CI: Increase timeouts and retries when accessing external destinations (#11770, @tgraf)
* Cilium has added support for "named ports". Updating docs to reflect this (#11754, @jedsalazar)
* cilium: improve bpf dp signal upon ct insertion error (#11684, @borkmann)
* CODEOWNERS: add helm as codeowner of install/kubernetes (#11723, @aanm)
* Correct cidr input in linuxRouting.NewRoutingInfo (#11569, @sayboras)
* datapath: Fix panic on direct routing config (#11756, @pchaigno)
* delete pkg/hubble/ipcache and GetIPIdentity func from ipcache (#11652, @Rolinh)
* doc: Fix require-ipv4-pod-cidr value for ENI and Azure mode (#11725, @tgraf)
* Doc: Update the unit test section for privileged tests (#11433, @soumynathan)
* doc: Use a personal registry for dev images (#11658, @michi-covalent)
* docker: update cilium-{runtime,builder} images (#11734, @borkmann)
* Dockerfile: Run apt-get update before apt-get install (#11665, @michi-covalent)
* docs: add missing dependency to use docs live-preview (#11761, @aanm)
* docs: add table for test-focus (#11752, @nebril)
* docs: Update debugging section for data races and deadlocks (#11700, @christarazi)
* Fix makefile and a small interface change (#11736, @anfernee)
* Fix various data races in pkg/aws/eni and pkg/ipam (#11685, @christarazi)
* helm: correct lint error in preflight template (#11671, @sayboras)
* hubble-relay: Add node status message (#11589, @gandro)
* hubble: delete parser/endpoint package and move Endpoint struct to testutils (#11769, @Rolinh)
* install: Fix erroneous comment (#11603, @joestringer)
* ipcache: Better logging for conflicting named ports (#11702, @jrajahalme)
* k8s,node: Reuse retrieveNodeInformation to retrieve node labels (#11659, @pchaigno)
* k8s: Fix CCNP for host policies (#11638, @pchaigno)
* loader: Fix missing dot in assembly output files (#11716, @pchaigno)
* loader: Move direct routing config. to node_config.h (#11594, @pchaigno)
* Make used version of some docker images consistent (#11728, @tklauser)
* Makefile: Fix build when RACE is provided (#11735, @christarazi)
* Makefile: Pass lockdebug tag to tests (#11657, @christarazi)
* monitor: Fix ipcache lookup debug msg (#11745, @pchaigno)
* policy/api: Rework Rule.MarshalJSON() to ease maintainability (#11651, @pchaigno)
* proxy: release redir.mutex on early exit, update a comment on mutex use (#11666, @qmonnet)
* Retry on conflicts when creating/updating CiliumNode objects on agent startup (#11673, @ashrayjain)
* Small bpf cleanups (#11688, @tklauser)
* Small scalability improvements (#11683, @aanm)
* test: Disable flaky etcd test (#11772, @pchaigno)
* test: Increase timeout for privileged unit tests (#11677, @pchaigno)
* test: Only restart KubeDNS if required (#11207, @tgraf)
* Use watcher to track unmanaged kube-dns pods in Cilium Operator (#11470, @aanm)
* vagrant: bump all vagrant box versions (#11695, @tklauser)
* vbox: update net-next box and runtime/builder images (#11649, @borkmann)
