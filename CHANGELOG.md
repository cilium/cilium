# Changelog

## v1.17.0-pre.1

Summary of Changes
------------------

**Major Changes:**
* feat: fast and standard queue in CES controller (cilium/cilium#34199, @Kaczyniec)

**Minor Changes:**
* Added Helm Chart value for overriding target namespace. (cilium/cilium#34624, @thewilli)
* Cilium now handles MTU changes to devices without restarting (cilium/cilium#34314, @dylandreimerink)
* cilium-cli: Deprecate --disable-check flag (cilium/cilium#34953, @michi-covalent)
* CiliumCIDRGroup now supports large numbers of CIDRs. CiliumCIDRGroup now integrates with Hubble flows. (cilium/cilium#33441, @squeed)
* daemon: bpf: add --bpf-conntrack-accounting-enabled flag (cilium/cilium#34921, @jibi)
* daemon: Make cilium status independent from k8s status (cilium/cilium#32724, @tkna)
* Enables a new metric in the cilium operator to indicate unmanaged pods. (cilium/cilium#34815, @nimishamehta5)
* envoy: Bump envoy version from v1.30.4 to v1.30.6 (cilium/cilium#34967, @sayboras)
* feat(cilium-cli-clustermesh): Improve --destination-context option for connecting multiple remote contexts (cilium/cilium#34510, @littlejo)
* Fix handling of route replace rules in ENI IPAM mode when `ipv4-native-routing-cidr` is set to `0.0.0.0/0`. (cilium/cilium#34436, @chapsuk)
* gateway-api: Add support for HTTP Retry (cilium/cilium#34720, @sayboras)
* gateway-api: Add support for mirror fraction (cilium/cilium#34602, @sayboras)
* gateway-api: Sync up with the latest upstream v1.2.0-rc1 (cilium/cilium#34807, @sayboras)
* Implement `cilium-dbg bpf frag list` command to list IPV4 datagram fragments. (cilium/cilium#34751, @Huweicai)
* k8s: Add "service.cilium.io/type" (cilium/cilium#34772, @brb)
* k8s: Add support for 1.31.0 (cilium/cilium#34463, @christarazi)
* Low-hanging fruit performance improvements of the hubble consumer module (cilium/cilium#34535, @giorio94)
* metrics: add structured format for Hubble metrics and options. (cilium/cilium#34849, @rectified95)
* Multi-Pool IPAM now allows the use of /32 or /128 CIDRs in CiliumPodIPPools (cilium/cilium#34618, @juliusmh)
* Remove workaround for Azure CNI bridge mode from nodeinit script. (cilium/cilium#34870, @wedaly)
* version: Don't create k8s client if --client is specified (cilium/cilium#34914, @michi-covalent)

**Bugfixes:**
* bgpv2: Fix service reconciliation logic to update service advertisement metadata only after successful reconciliation (cilium/cilium#34976, @rastislavs)
* bpf: nat: recreate a NAT entry if the packet hits the stale entry (cilium/cilium#34913, @ysksuzuki)
* cli: fix a case when connectivity perf command was hanging if LRP was enabled in the cluster (cilium/cilium#35063, @marseel)
* Correctly format `cilium status -o json` CLI output for errors and warnings (cilium/cilium#34654, @nimishamehta5)
* Fix a low-probability issue where the DNS proxy could occasionally drop DNS queries due to "duplicate request id" errors. (cilium/cilium#34941, @bimmlerd)
* Fix Hubble exporter config uses wrong separator (cilium/cilium#34621, @chaunceyjiang)
* Fix issue where bpf packet buffer mark would in some cases set incorrect mark value resulting in incorrectly SNATed traffic. (cilium/cilium#34789, @tommyp1ckles)
* Fix missing Helm chart version for status command (cilium/cilium#34748, @pgils)
* Fix parameter check to forbid IPAM ENI with TUNNEL routing, and prevent agent segfault when also IPSec is enabled. (cilium/cilium#34651, @smagnani96)
* Fix possible panic occurring in case errors are returned while updating/deleting IPv6 routes (cilium/cilium#34721, @giorio94)
* Fix runtime panic with L2announcer name generation (cilium/cilium#35031, @YutaroHayakawa)
* Fix services could not be removed in sync-lb-maps-with-k8s-services controller (cilium/cilium#33885, @haozhangami)
* Fix the Egress Gateway reconciliation logic to make progress after setting the rp_filter sysctl failed. (cilium/cilium#34775, @julianwiedmann)
* fix(clustermesh): mesh connection mode (cilium/cilium#34932, @littlejo)
* Fixed bug in LB-IPAM where restarting the operator would unshare previously shared IPs between services (cilium/cilium#34783, @dylandreimerink)
* Fixed bug where service id allocator would loop infinity when out of service ids (cilium/cilium#35033, @WeeNews)
* Fixes deadlock in identity watcher. This fixes an issue where a kvstore disconnect can cause the event receiver to exit and the event sender to get stuck forever. (cilium/cilium#34611, @dboslee)
* Fixes startup fatal error when updating CiliumNode resource. (cilium/cilium#34862, @harsimran-pabla)
* gateway-api: Align GRPCRoute matchers with GEP specification (cilium/cilium#34808, @cfsnyder)
* helm: Render valid image specs when tag is empty (cilium/cilium#34891, @BenoitKnecht)
* ipcache: Yet another refcounting fix with mix of APIs (cilium/cilium#34715, @gandro)
* lrp: define ENABLE_LOCAL_REDIRECT_POLICY regardless of socketLB setting (cilium/cilium#34954, @ysksuzuki)
* Make initial nat gc async during Daemon initialization. (cilium/cilium#34070, @tommyp1ckles)
* Metrics: Fix the reporting of bootstrap metric "overall" scope as it was not capturing a part of initialization (cilium/cilium#34971, @marseel)
* The cilium dnsproxy now handles EDNS0 large buffersize advertisements better. (cilium/cilium#34852, @bimmlerd)
* wireguard: Fix issue where updates to a WireGuard device's configuration caused connectivity blips. (cilium/cilium#34612, @jrife)

**CI Changes:**
* .github/workflows: fix ci image cache cleaner (cilium/cilium#34819, @aanm)
* .github: add missing export in variable (cilium/cilium#34818, @aanm)
* .github: change nick-invision/retry -> nick-fields/retry. (cilium/cilium#34718, @tommyp1ckles)
* .github: create cache directories on cache miss (cilium/cilium#35088, @aanm)
* .github: install golang action after checkout (cilium/cilium#34843, @aanm)
* .github: prevent failure when deleting GitHub Actions cache (cilium/cilium#34844, @aanm)
* .github: re-enable configurations in e2e-upgrade (cilium/cilium#34800, @aanm)
* .github: remove CI tests from PR runs if not required (cilium/cilium#34726, @aanm)
* .github: specify cache-dependency-path in lint-workflows (cilium/cilium#34845, @aanm)
* ariane: don't run full test suite for BPF test changes (cilium/cilium#34931, @julianwiedmann)
* ariane: manage workflow exclusions for changes to CODEOWNERS and USERS.md (cilium/cilium#34894, @julianwiedmann)
* bpf/complexity-tests: Add ENABLE_LOCAL_REDIRECT_POLICY (cilium/cilium#35016, @ysksuzuki)
* bpf/complexity-tests: fix ENABLE_LOCAL_REDIRECT_POLICY (cilium/cilium#35099, @ysksuzuki)
* ci: 100 node scale - alert on bootstrap/cpu/memory regressions (cilium/cilium#34897, @marseel)
* ci: clean disk only on ubuntu-latest runners (cilium/cilium#34711, @marseel)
* ci: conformance-[gateway-api|ginkgo|ingress] wait for images before matrix generation (cilium/cilium#34820, @aanm)
* ci: Confromance E2E wait for images before matrix generation (cilium/cilium#34707, @marseel)
* CI: Fix syntax error in Image Cache Cleaner (cilium/cilium#35104, @brlbil)
* CI: l4lb allow extra opts (cilium/cilium#34813, @tommyp1ckles)
* ci: Move CiliumEndpointSlice migration to schedule (cilium/cilium#34828, @marseel)
* ci: Wait for images before generating test matrix (cilium/cilium#34727, @marseel)
* cilium-cli: connectivity: fix the local-redirect-policy flow validation (cilium/cilium#34919, @ysksuzuki)
* cilium-cli: Define CLI_MAIN_DIR Make variable (cilium/cilium#34910, @michi-covalent)
* fix: repository nil value handled on workflow_dispatch context for renovate updates (cilium/cilium#34902, @Artyop)
* gha: Enable Ingress Controller test in upgrade (cilium/cilium#34185, @sayboras)
* gha: fix permissions of update label backport PR workflow (cilium/cilium#35117, @giorio94)
* metrics: Add metrics config test for Hubble. (cilium/cilium#34325, @rectified95)
* Miscellaneus improvements to the clustermesh scale test (cilium/cilium#34704, @giorio94)
* Revert "ci: increase verbosity of print-downgrade-script.sh" (cilium/cilium#34863, @marseel)
* Run scheduled workflows every 8h instead of 6h (cilium/cilium#34898, @auriaave)
* test: add dual-stack to delegated IPAM E2E test (cilium/cilium#34937, @wedaly)
* test: Add unit tests for directory policy watcher (cilium/cilium#33920, @tamilmani1989)
* test: Cilium Identity management tests (cilium/cilium#34743, @dlapcevic)
* test: e2e tests for delegated IPAM (cilium/cilium#34839, @wedaly)

**Misc Changes:**
* .github/labeler: add exclusive cilium-cli label (cilium/cilium#34771, @aanm)
* .github: add cache to cilium-cli and hubble-cli build workflows (cilium/cilium#34847, @aanm)
* .github: do not update github runners for bpf workflows (cilium/cilium#35105, @aanm)
* .github: fix lvh-kind warnings (cilium/cilium#34811, @aanm)
* .github: fix runtime image digests (cilium/cilium#35107, @aanm)
* .mailmap: Add entry for Quentin's email (cilium/cilium#34708, @qmonnet)
* Add flag enabling LB IPAM (cilium/cilium#34945, @nebril)
* Add Jar to the users.md (cilium/cilium#34952, @rohan-changejar)
* Add Nutanix user (cilium/cilium#34752, @tuxtof)
* agent: add flag to enable internal traffic policy (cilium/cilium#34858, @nebril)
* agent: drop leftover logstash constant/field (cilium/cilium#34722, @giorio94)
* AUTHORS: fix duplicate entries (cilium/cilium#34714, @aanm)
* bgpv1: Add MatchFamilies option in RoutePolicyConditions (cilium/cilium#34674, @rastislavs)
* bgpv1: Cleanup BGP reconcilers setup to ensure that no BGP CP jobs are started when BGP CP is disabled (cilium/cilium#34836, @rastislavs)
* bgpv2/docs: add ebgp multihop documentation (cilium/cilium#34951, @harsimran-pabla)
* bgpv2: cleanup service reconciliation logic (cilium/cilium#34959, @rastislavs)
* Bitlpm fixes and improvements (cilium/cilium#34781, @jrajahalme)
* bpf/lib/icmpv6.h: cleanup hardcoded ICMPv6 types (cilium/cilium#34942, @msune)
* bpf: compile-test ENABLE_IP_MASQ_AGENT_IPV* (cilium/cilium#34701, @julianwiedmann)
* bpf: tests: don't specify ETH_HLEN for L2 devices (cilium/cilium#34906, @julianwiedmann)
* bpf: vxlan helper improvements (cilium/cilium#34755, @julianwiedmann)
* bugtool: collect `cilium-dbg bpf frag list` output (cilium/cilium#34868, @julianwiedmann)
* build-images-ci: skip SBOM for cilium-cli (cilium/cilium#35116, @aanm)
* Bump k8s version to 1.31 in some missing files (cilium/cilium#34778, @aanm)
* Bump StateDB to v0.3 with range-funcs (cilium/cilium#34729, @joamaki)
* chore(deps): update all github action dependencies (main) (cilium/cilium#34759, @cilium-renovate[bot])
* chore(deps): update all github action dependencies (main) (cilium/cilium#34877, @cilium-renovate[bot])
* chore(deps): update all github action dependencies (main) (cilium/cilium#35004, @cilium-renovate[bot])
* chore(deps): update all github action dependencies (main) (cilium/cilium#35078, @cilium-renovate[bot])
* chore(deps): update all-dependencies (main) (cilium/cilium#34757, @cilium-renovate[bot])
* chore(deps): update all-dependencies (main) (cilium/cilium#34872, @cilium-renovate[bot])
* chore(deps): update all-dependencies (main) (cilium/cilium#34969, @cilium-renovate[bot])
* chore(deps): update dependency cilium/cilium-cli to v0.16.17 (main) (cilium/cilium#34875, @cilium-renovate[bot])
* chore(deps): update dependency cilium/cilium-cli to v0.16.18 (main) (cilium/cilium#34998, @cilium-renovate[bot])
* chore(deps): update dependency renovatebot/renovate to v38.80.0 (main) (cilium/cilium#34882, @cilium-renovate[bot])
* chore(deps): update docker.io/library/golang:1.23.1 docker digest to 2fe82a3 (main) (cilium/cilium#34873, @cilium-renovate[bot])
* chore(deps): update docker.io/library/golang:1.23.1 docker digest to 4f063a2 (main) (cilium/cilium#35075, @cilium-renovate[bot])
* chore(deps): update go to v1.23.1 (main) (cilium/cilium#34732, @cilium-renovate[bot])
* chore(deps): update golangci/golangci-lint docker tag to v1.61.0 (main) (cilium/cilium#34826, @cilium-renovate[bot])
* chore(deps): update https://github.com/cilium/scaffolding digest to a97aaf1 (main) (cilium/cilium#35100, @cilium-renovate[bot])
* chore(plugins): replace deprecated CNI function (cilium/cilium#34561, @SkalaNetworks)
* chore: Add constants for cloud APIs (cilium/cilium#34438, @jaffcheng)
* ci: fix ginkgo by replace k8s v1.27 with v1.31 (cilium/cilium#34773, @mhofstetter)
* cilium-cli/status: sort status lines (cilium/cilium#34927, @tklauser)
* cilium-cli/sysdump: export SubmitMetricsSubtask (cilium/cilium#34864, @tklauser)
* cilium-cli: collect BGPv2 CRD resources in sysdump (cilium/cilium#34684, @rastislavs)
* cilium-cli: remove copying of loop variables (cilium/cilium#34944, @tklauser)
* cilium-dbg: Show deleted objects when watching StateDB tables (cilium/cilium#34635, @joamaki)
* cilium: add minor annotation mode follow-ups (cilium/cilium#35102, @borkmann)
* cilium: add option to configure service annotation-based dispatch (cilium/cilium#35064, @borkmann)
* cilium: Enable health datapath also in annotation mode (cilium/cilium#35124, @borkmann)
* cli/connectivity: improvements for echo-ingress-l7-via-hostport test (cilium/cilium#34502, @julianwiedmann)
* clustermesh/endpointslicesync: fix panic on failure in Test_meshEndpointSlice_Reconcile (cilium/cilium#34699, @tklauser)
* datapath: clarify comment for EncryptNode (cilium/cilium#34924, @julianwiedmann)
* docs(users): add SDV Services (cilium/cilium#34746, @sjoukedv)
* docs, LRP: add note regarding the KPR configuration (cilium/cilium#35030, @ysksuzuki)
* docs: Clarify instructions for bumping K8s to avoid forks (cilium/cilium#34791, @christarazi)
* docs: fix EKS Kubernetes compatibility link (cilium/cilium#34922, @fjvela)
* docs: Improve warning on insecure global IPsec keys (cilium/cilium#34846, @pchaigno)
* docs: move sig-policy to second Tuesday of the month (cilium/cilium#35040, @squeed)
* Document about multicast sub-command of cilium-cli (cilium/cilium#34987, @yushoyamaguchi)
* driftchecker: Allow agent to monitor configuration drifts (cilium/cilium#34712, @ovidiutirla)
* egressgw: skip gateway config update on endpoint change events (cilium/cilium#34795, @julianwiedmann)
* endpoint: Use nanoseconds in policy logs (cilium/cilium#34679, @jrajahalme)
* envoy: Add configuration for OverloadManager (cilium/cilium#34682, @sayboras)
* envoy: possibility to configure separate default log level for Envoy (cilium/cilium#34728, @mhofstetter)
* envoy: update cilium/proxy to latest version (cilium/cilium#34769, @mhofstetter)
* experimental: Benchmark reconciling tables and BPF (cilium/cilium#34487, @DamianSawicki)
* feat(helm): allow setting resources for spire agent and server workloads (cilium/cilium#34822, @sjoukedv)
* fix add spi=0 to ipSecKeysRemovalTime (cilium/cilium#34652, @smagnani96)
* fix(deps): update all go dependencies main (main) (cilium/cilium#34548, @cilium-renovate[bot])
* fix(deps): update all go dependencies main (main) (cilium/cilium#34920, @cilium-renovate[bot])
* fix(deps): update all go dependencies main (main) (cilium/cilium#35024, @cilium-renovate[bot])
* fix(deps): update aws-sdk-go-v2 monorepo (main) (cilium/cilium#34758, @cilium-renovate[bot])
* fix(deps): update aws-sdk-go-v2 monorepo (main) (cilium/cilium#35003, @cilium-renovate[bot])
* fix(deps): update aws-sdk-go-v2 monorepo (main) (cilium/cilium#35077, @cilium-renovate[bot])
* fix(deps): update kubernetes packages to v0.31.1 (main) (cilium/cilium#34853, @cilium-renovate[bot])
* fix(deps): update opentelemetry-go monorepo to v1.30.0 (main) (cilium/cilium#34876, @cilium-renovate[bot])
* Fixed TestWatchAllKeys UT (cilium/cilium#35009, @chaunceyjiang)
* gateway-api: Enable GatewayStaticAddresses test in CI (cilium/cilium#34695, @sayboras)
* gateway-api: Sync up with latest version upstream (cilium/cilium#35047, @sayboras)
* generic-veth will ignore the automatically generated link-local IPv6 addresses on the link. (cilium/cilium#33959, @BSWANG)
* go: Replace x/maps package by respective standard libraries (cilium/cilium#34649, @sayboras)
* helm: add client auth to hubble server certificate (cilium/cilium#34934, @kaworu)
* helm: set key usages for hubble certificates with cert-manager (cilium/cilium#34946, @kaworu)
* hive/k8s: Add OnDemand[T] and the OnDemandTable (cilium/cilium#34799, @joamaki)
* hubble/filters: use netip types (cilium/cilium#34803, @tklauser)
* hubble: add file name and line number info to dropped flows (cilium/cilium#34616, @kaworu)
* images: fix path script (cilium/cilium#34764, @aanm)
* Improve speed on lint commits GH workflow (cilium/cilium#34848, @aanm)
* ingress: export Config[T] type. (cilium/cilium#34812, @tommyp1ckles)
* job: Prepare job names for hive bump (cilium/cilium#34838, @ovidiutirla)
* k8s: Convert service.cilium.io/node to annotation (cilium/cilium#34739, @brb)
* kvstore: remove obsolete key encoding/decoding methods (cilium/cilium#34925, @tklauser)
* kvstore: Remove SessionID from kvstore Value (cilium/cilium#34895, @odinuge)
* lbipam: Remove init done callback hooks (cilium/cilium#34785, @dylandreimerink)
* Link ariane triggers in testing/CI documentation. (cilium/cilium#34869, @sypakine)
* loader: de-dup LinkByName() calls for overlay / wireguard setup (cilium/cilium#34705, @julianwiedmann)
* Make flag that instructs LB-IPAM to only allocate IPs for services with .Spec.LoadBalancerClass specified functional (cilium/cilium#34985, @simu)
* Makefile: retry on kind load docker-image errors (cilium/cilium#34907, @jibi)
* operator: remove helper function `model.AddressOf` (cilium/cilium#34765, @mhofstetter)
* pkg/ciliumidentity: Prevent updateCID from modifying the resource store (cilium/cilium#34805, @ovidiutirla)
* pkg/ciliumidentity: Use hive cell context (cilium/cilium#34565, @ovidiutirla)
* pkg/dynamicconfig: Add support for multiple sources (cilium/cilium#34581, @ovidiutirla)
* policy: add flag enabling non-default-deny policy (cilium/cilium#34940, @nebril)
* policy: Fix Key stringer port range output (cilium/cilium#34842, @jrajahalme)
* Prepare for release v1.17.0-pre.0 (cilium/cilium#34694, @cilium-release-bot[bot])
* Re-write GitHub cache usages across workflows (cilium/cilium#34866, @aanm)
* README: Update releases (cilium/cilium#34710, @aanm)
* README: Update releases (cilium/cilium#35054, @nebril)
* Refactor the CiliumEndpointSlice subscriber public methods and increase test coverage (cilium/cilium#34671, @sypakine)
* Remove conformance-e2e tests (cilium/cilium#34742, @aanm)
* Remove note about TLSRoute being required by Cilium (cilium/cilium#34817, @youngnick)
* renovate: Correct the regex for cilium-envoy image (cilium/cilium#34886, @sayboras)
* renovate: Update allowedVersion for cilium-envoy (cilium/cilium#34978, @sayboras)
* Reuse deny CIDR benchmark in allow CIDR benchmark (cilium/cilium#34996, @christarazi)
* Services protocol differentiation: minor follow ups (cilium/cilium#34955, @jibi)
* Set go version to v1.23 in go.mod and fix codegen issue (cilium/cilium#34725, @joamaki)
* Show exact error message for "Error reading config file" (cilium/cilium#34617, @jingyuanliang)
* Transactional selector cache (cilium/cilium#34205, @jrajahalme)
* Use Go standard library slices package more extensively (cilium/cilium#34796, @tklauser)
* vendor: Bump StateDB to v0.2.6 and fix usage (cilium/cilium#34669, @joamaki)
* wireguard: Move private key generation to start (cilium/cilium#34860, @joamaki)

