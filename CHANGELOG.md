# Changelog

## v1.12.0-rc1

Summary of Changes
------------------

**Major Changes:**
* Add cilium ingress controller implementation (#18867, @sayboras)
* Add support for CiliumEnvoyConfig CRD. (#18894, @michi-covalent)
* Add support for enabling BBR congestion control for Pods, and move bandwidth manager out of beta. (#19287, @borkmann)
* Adding support for AWS ENI prefix delegation - IPv4 Only (#18463, @hemanthmalla)
* Cilium: initial NAT46/64 implementation (#18779, @borkmann)
* Implementation of a GoBGP backed BGP control plane. (#18860, @ldelossa)

**Minor Changes:**
* Add support for aws-cni chaining in IPv6 EKS clusters (#18522, @mKeRix)
* api,cli: add identity range in status response & cli output (#18152, @ArthurChiao)
* AWS EC2 Instance tag filter (#19181, @prune998)
* aws: Add ability to mark ENIs as unmanaged (#19096, @gandro)
* bpf, Hubble: Add `is_reply` information (when available) at the `TO_OVERLAY` observability point (#19185, @qmonnet)
* clustermesh: added new command-line options k8s-kubeconfig-path and clustermesh-health-port (#18803, @abocim)
* datapath: make tc filter priority configurable (#18896, @intel-dlanders)
* docs: Update alibabacloud RAM permission requirements (#19077, @jaffcheng)
* Enable VTEP integration dynamic ARP resolution for Cilium-managed pod (#18758, @vincentmli)
* Envoy upstream connections no longer use the original source address for any destination associated with a CIDR or toFQDNs policy. (#19255, @jrajahalme)
* Fixes L7 policies with Azure CNI chaining. (#19088, @nitishm)
* helm: Move tls related helm option to 1.12 in upgrade docs (#19089, @sayboras)
* hubble: Add "flows-to-world" metric to monitor policy decisions on traffic that reaches outside the cluster. (#17790, @michi-covalent)
* k8s: keep CiliumNode labels synced with Node object (#18609, @jibi)
* Locally allocated identities are now restored during restart, helping avoid transient drops due to identity changes in policies. (#19360, @jrajahalme)
* metrics: Add go_* metrics (#19153, @chancez)
* proxy: Add proxy common http options arguments to agent (#19138, @jmcshane)
* Rename bpf.hostRouting to bpf.hostLegacyRouting in ciliumconfig (#19064, @chenk008)

**Bugfixes:**
* alibabacloud: Fix derived VPC CIDR block (#19056, @jaffcheng)
* Cilium monitor now correctly reports security identities for L7 flows. (#18783, @jrajahalme)
* cilium: Fix node mismatch endpoint restoration bug when the CiliumEndPoint CRD is disabled. (#19040, @zhanghe9702)
* clustermesh: Correct shared service annotation behaviour (#19042, @sayboras)
* clustermesh: fix: identities allocation range (#19076, @abocim)
* cmd: Fix issue where a ConfigMap value of `{}` was parsed as `map["{}":""]`. (#19172, @gandro)
* datapath/config: Fix L2 addr retrieval (#19081, @brb)
* datapath: Fix security ID propagation in tunnel header for NodePort BPF forwarded requests (#19061, @brb)
* Fix 'node-init' in GKE's 'cos' images. (#19017, @bmcustodio)
* Fix a bug where a backend pod can be selected by a local redirect policy deployed in a different namespace if the local redirect policy was deployed first. (#19193, @aditighag)
* Fix bug that would cause some pod traffic to leave through the wrong interface if --aws-release-excess-ips is used and masquerading disabled. (#19162, @pchaigno)
* Fix bug where FQDN policy calculation could trigger a deadlock in cilium-agent (#19031, @joestringer)
* Fix bug where the 'ipcache-inject-labels' controller constantly fails in non-Kubernetes environments (#19165, @christarazi)
* Fix bug where the Cilium DNS proxy slows down significantly (and even OOMs) due to lock contention from spawning many goroutines when handling bursty DNS traffic (#19336, @nebril)
* Fix concurrency issue while waiting for node-init DaemonSet to be ready (#18897, @aanm)
* Fix drop for packets sent via AF_PACKET + mmap ring buffer in pod (#19308, @liuyuan10)
* Fix issue where StatefulSet pod restarts could trigger persistent connectivity issues for the pods due to overzealous CiliumEndpoint resource removal by cilium-agent instances (#18864, @timoreimann)
* Fix log rotation of compressed logs (#19152, @chancez)
* Fixed a bug where deleted identities would remain in BPF policy maps. (#19005, @jrajahalme)
* Fixed node init in RKE (#19286, @raphink)
* Fixed removal of stale bpf_netdev tc filters for interfaces with a dot in the name (#18344, @stek29)
* helm: Fix invalid type for Certificate spec.ipAddresses (#19211, @superbrothers)
* helm: Removed unnecessary Kubernetes RBAC permissions for cilium-agent (#19053, @nathanjsweet)
* helm: Update Clustermesh-APIServer RBAC permissions for platforms (like Openshift) that have the OwnerReferencesPermissionEnforcement admission controller enabled. (#19071, @nathanjsweet)
* Improve endpoint and DNS proxy lock contention during bursty DNS traffic (#19347, @christarazi)
* Improve reliably of faulty connections for kube-apiservers behind a LB. Reduce the number of connections to kube-apiserver by 6 for each cilium-agent. (#19259, @aanm)
* install/kubernetes: fix hubble-ui with TLS (#19338, @aanm)
* metallb: fix SIGSEGV error when Service resource is deleted. (#19249, @Inode1)
* Update the 'refresh period' formatting in readme and doc (#19205, @dongwangdw)
* wireguard: Reject duplicate public keys (#19344, @gandro)

**CI Changes:**
* .github: Change cilium-cleanup order in workflows (#19163, @jtaleric)
* .github: Exclude Runtime CI job from flake tracker (#19095, @pchaigno)
* ci: create a new subnetwork for each new GKE cluster (#18821, @nbusseneau)
* connectivity-check: Use ports outside ephemeral range (#19337, @christarazi)
* jenkinsfiles: Update calls to Quay API (#19229, @pchaigno)
* Revert "workflows: Reenable IPsec test in EKS workflow" (#19078, @pchaigno)
* test/RuntimePrivilegedUnitTests: Fix always-passing test (#19231, @pchaigno)
* test/RuntimePrivilegedUnitTests: Log timestamps (#19129, @pchaigno)
* test: Runtime check that container create succeeds (#19184, @jrajahalme)
* Use docker manifest inspect to wait for images instead of using quay API (#19307, @YutaroHayakawa)
* vagrant: Bump all Vagrant box versions (#19168, @pchaigno)
* workflow CI image bug (#19327, @weizhoublue)
* workflow: Reenable IPsec testing on AKS (#18974, @pchaigno)
* workflow: Reenable IPsec testing on EKS (#19030, @pchaigno)
* workflows: pin Cyclonus image to its SHA (#19026, @nbusseneau)
* workflows: Update call to Quay API (#19228, @pchaigno)
* workflows: Update call to Quay API in external workloads (#19230, @jibi)
* workflows: Wait for first AKS systempool to be deleted (#19097, @pchaigno)

**Misc Changes:**
* .github: Remove release template (#19166, @joestringer)
* add 'refreshPeriod' to spelling wordlist (#19394, @aanm)
* Add a 'Limitations' section to 'External Workloads'. (#19366, @bmcustodio)
* Add Infomaniak to Cilium users (#19354, @reneluria)
* Add link to CFP template doc (#19380, @lizrice)
* Add MyFitnessPal to Users list (#19345, @audip)
* Add Rancher Labs to Cilium users (#19292, @divya-mohan0209)
* add website contributing link (#18940, @xmulligan)
* added a CLOMonitor exception file for Slack (#19235, @xmulligan)
* added a link to the DCO page to show people how to amend a commit (#19294, @xmulligan)
* added Google Season of Docs Project proposal page (#19215, @xmulligan)
* added NYT to the Cilium Users list (#19382, @prune998)
* alibabacloud: Fix missing instance due to incomplete subnet list (#19155, @jaffcheng)
* Badges for CLOMonitor and Artifacthub were added to the README (#19105, @xmulligan)
* Bpf fix conditional compilation (#19104, @jrajahalme)
* bpf, hubble: explicitly mark trace reason as "unknown" when relevant (#19226, @qmonnet)
* bpf: Add trace reason for TRACE_TO_PROXY (#19189, @borkmann)
* bpf: fix native local build (#19218, @aanm)
* bpf: Remove DNS quirk for monitor aggregation (#19108, @borkmann)
* build(deps): bump actions/cache from 2.1.7 to 3 (#19208, @dependabot[bot])
* build(deps): bump actions/cache from 3.0.0 to 3.0.1 (#19271, @dependabot[bot])
* build(deps): bump actions/cache from 3.0.1 to 3.0.2 (#19391, @dependabot[bot])
* build(deps): bump docker/build-push-action from 2.9.0 to 2.10.0 (#19144, @dependabot[bot])
* build(deps): bump github.com/cilium/workerpool from 1.1.1 to 1.1.2 (#19300, @dependabot[bot])
* build(deps): bump github.com/containernetworking/plugins from 1.0.1 to 1.1.0 (#19043, @dependabot[bot])
* build(deps): bump github.com/containernetworking/plugins from 1.1.0 to 1.1.1 (#19293, @dependabot[bot])
* build(deps): bump github.com/docker/docker from 20.10.12+incompatible to 20.10.14+incompatible (#19285, @dependabot[bot])
* build(deps): bump github.com/go-openapi/runtime from 0.23.1 to 0.23.3 (#19302, @dependabot[bot])
* build(deps): bump github.com/onsi/gomega from 1.17.0 to 1.19.0 (#19234, @dependabot[bot])
* build(deps): bump github.com/prometheus/client_golang from 1.11.0 to 1.12.1 (#18674, @dependabot[bot])
* build(deps): bump github.com/shirou/gopsutil/v3 from 3.21.12 to 3.22.2 (#19001, @dependabot[bot])
* build(deps): bump github.com/spf13/cobra from 1.3.0 to 1.4.0 (#19329, @dependabot[bot])
* build(deps): bump github.com/stretchr/testify from 1.7.0 to 1.7.1 (#19156, @dependabot[bot])
* build(deps): bump github/codeql-action from 1.1.3 to 1.1.4 (#19084, @dependabot[bot])
* build(deps): bump github/codeql-action from 1.1.4 to 1.1.5 (#19160, @dependabot[bot])
* build(deps): bump github/codeql-action from 1.1.5 to 2.1.6 (#19269, @dependabot[bot])
* build(deps): bump github/codeql-action from 2.1.6 to 2.1.7 (#19335, @dependabot[bot])
* build(deps): bump github/codeql-action from 2.1.7 to 2.1.8 (#19371, @dependabot[bot])
* build(deps): bump go.etcd.io/etcd/client/v3 from 3.5.1 to 3.5.2 (#19054, @dependabot[bot])
* build(deps): bump go.uber.org/multierr from 1.7.0 to 1.8.0 (#19114, @dependabot[bot])
* build(deps): bump golang.org/x/tools from 0.1.8 to 0.1.10 (#19157, @dependabot[bot])
* build(deps): bump google-github-actions/setup-gcloud from 0.5.1 to 0.6.0 (#19094, @dependabot[bot])
* build(deps): bump google.golang.org/grpc from 1.43.0 to 1.45.0 (#19301, @dependabot[bot])
* build(deps): bump google.golang.org/protobuf from 1.27.1 to 1.28.0 (#19284, @dependabot[bot])
* build(deps): bump KyleMayes/install-llvm-action from 1.5.1 to 1.5.2 (#19322, @dependabot[bot])
* build: Fix cross compiling for amd64 on arm64 (#19175, @jrajahalme)
* ci: Pin down image for the documentation workflow (#19356, @qmonnet)
* cilium, lbmap: Use silent delete in deleteBackendLocked for now (#19352, @borkmann)
* cilium: nat46/64 ci codeowner & monitor drop reason (#19298, @borkmann)
* Clarify taint effects in the documentation. (#19186, @bmcustodio)
* CODEOWNERS: Add clustermesh entries (#19316, @pchaigno)
* contrib/backporting: Include golang in the image (#18664, @glibsm)
* contrib: Make KIND cluster ipFamily configurable (#19068, @brb)
* Crane joins Cilium as a user (#19065, @slzcc)
* daemon, install/kubernetes: fix typo in DNS policy rule unload flag/value doc (#18982, @tklauser)
* daemon: Deprecate --host-reachable-services-protos (#19083, @brb)
* daemon: Don't ignore sockops failures (#19080, @pchaigno)
* daemon: don't mark deprecated flags as hidden twice (#19086, @tklauser)
* development: add kind cluster shell helpers (#19069, @ldelossa)
* docs,ci: updates to ci docs (#19174, @ldelossa)
* docs: Add read:user scope for github token (#19063, @sayboras)
* docs: adding Accuknox to USERS (#19103, @nyrahul)
* docs: adding Nexxiot to USERS (#19332, @alex-berger)
* docs: adding Snapp to USERS (#19128, @m-yosefpor)
* docs: Clarify use of the `eni.subnetTagsFilter` option (#19276, @gandro)
* docs: Document monitor aggregation levels (#19349, @michi-covalent)
* docs: Document unsupported focused tests for runtime suite (#19173, @aditighag)
* docs: fix tip about opening the Hubble server port on all nodes (#19036, @rolinh)
* docs: Update shared service annotation docs (#19313, @sayboras)
* Document installing Cilium on Rancher Desktop (#19049, @chancez)
* endpoint: Print error for regeneration timeout (#19333, @pchaigno)
* eni: Fix broken build due to unit test (#19278, @gandro)
* Envoy update for service mesh (#19101, @jrajahalme)
* envoy: Limit accesslog socket permissions (#19190, @jrajahalme)
* Fix smoke tests by filtering out go_* metrics from metrics linting (#19399, @chancez)
* go.mod: update kevinburke/ssh_config dependency (#19289, @kevinburke)
* helm: Bump cilium/startup-script image tag (#19263, @gandro)
* hubble: read proxy port from trace event (#18510, @zhanghe9702)
* images: Remove copyright years from copyright notices (#19359, @qmonnet)
* images: Update bpftool (#19046, @pchaigno)
* ipcache: Add test asserting out-of-order Kubernetes events (#19258, @christarazi)
* ipcache: Use incremental policy updates (#18996, @joestringer)
* k8s: Use kubelet's logic to close all idle connections (#19290, @christarazi)
* List Simple Life as Cilium user (#19377, @sergeyshevch)
* loader: Use new eBPF ISA feature probes (#19170, @pchaigno)
* localdev: fix kind helm install shell function (#19149, @ldelossa)
* logo: fix position of central polygon (#19216, @sisp)
* Make API ratelimit logs less noisy by default (#18934, @panchm)
* Makefile: Fix TESTPKGS commandline (#19100, @joestringer)
* node: don't set write-only NodeAddressingElement.AddressType property (#19044, @tklauser)
* None (#19280, @pacoxu)
* pkg/mac refactor for common code use (#18793, @vincentmli)
* Prepare for release v1.12.0-rc0 (#19032, @aanm)
* README.rst: Add subsections on Governance and Adopters to make the info more discoverable, and to satisfy CLOMonitor (#19037, @xmulligan)
* Reduce datapath from_lxc complexity (#17758, @jrajahalme)
* Refactor IPCache to remove static package-level globals (#19073, @joestringer)
* Revert "build(deps): bump github.com/prometheus/client_golang" (#19398, @aanm)
* Revert "build(deps): bump google.golang.org/protobuf from 1.27.1 to 1… (#19395, @aanm)
* Spell out the full term of the CRD acronym (#19381, @Kikiodazie)
* Tencent Cloud added as a user (#19183, @xmulligan)
* Test runtime cilium in container (take two) (#19310, @jrajahalme)
* test/bpf: Fix mock dependencies (#19099, @joestringer)
* test: fix typo in log output (#19134, @julianwiedmann)
* test: Fix whitespace in docker-run-cilium (#19358, @jrajahalme)
* Update CLOMonitor badge url (#19365, @cynthia-sg)
* Update Copyright header in identity_range.go (#19115, @ti-mo)
* Update external docker images (#19384, @aanm)
* Update Go to 1.17.8 (#19058, @tklauser)
* Update Go to 1.18 (#19169, @tklauser)
* Update stable releases (#19242, @aanm)
* Upgrade to cilium/lumberjack v2.2.2 to Flush() gzip writer before Sync()ing (#19361, @chancez)
* Users page now includes platforms, products, and services (#19357, @xmulligan)
* Vagrant cleanups (#19253, @julianwiedmann)
* vagrant: fix overlap of IPv6 Node/Pod CIDRs on dev-VM (#19303, @julianwiedmann)
* wireguard: Fix invalid bits when agent init (#19118, @Junnplus)
* WithDialer is deprecated and use WithContextDialer instead (#19281, @luckymrwang)
