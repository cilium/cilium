package tpl

const moduleFileTpl = `// Code generated by protoc-gen-validate
// source: {{ .InputPath }}
// DO NOT EDIT!!!

#include "{{ .File.OutputPath.SetExt ".validate.h" }}"

namespace pgv {
namespace validate {
using std::string;

{{ range .AllMessages }}
{{- if not (disabled .) -}}
bool CheckMessage(const {{ class . }}& m, pgv::ValidationMsg* err) {
	return {{ package . }}::Validate(m, err);
}
{{ end }}
{{ end }}

{{ range (weakCheckMsgs .AllMessages) }}
bool __attribute__((weak)) CheckMessage(const {{ . }}& m, pgv::ValidationMsg* err) {
	return true;
}
{{ end }}

} // namespace validate
} // namespace pgv

{{ range .Package.ProtoName.Split }}
namespace {{ . }} {
{{- end }}

{{ range .AllMessages }}
	{{- template "msg" . }}
{{ end }}

{{ range .Package.ProtoName.Split -}}
} // namespace
{{ end }}
`

const headerFileTpl = `// Code generated by protoc-gen-validate
// source: {{ .InputPath }}
// DO NOT EDIT!!!

#pragma once

#include <string>
#include <sstream>
#include <unordered_set>

#include "validate/validate.h"
#include "{{ .File.OutputPath.SetExt ".h" }}"

{{ range .Package.ProtoName.Split }}
namespace {{ . }} {
{{- end }}

using std::string;

{{ range .AllMessages }}
	{{- template "decl" . }}
{{ end }}

{{ range .Package.ProtoName.Split -}}
} // namespace
{{ end }}

#define X_{{ .Package.ProtoName.ScreamingSnakeCase }}_{{ .File.InputPath.BaseName | upper }}(X) \
{{ range .AllMessages -}}
	X({{class . }}) \
{{ end }}
`
