---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.3
  name: ciliumenvoycircuitbreakers.cilium.io
spec:
  group: cilium.io
  names:
    categories:
    - cilium
    kind: CiliumEnvoyCircuitBreaker
    listKind: CiliumEnvoyCircuitBreakerList
    plural: ciliumenvoycircuitbreakers
    shortNames:
    - cecb
    singular: ciliumenvoycircuitbreaker
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: The age of the resource
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v2
    schema:
      openAPIV3Schema:
        description: |-
          CiliumEnvoyCircuitBreaker is a CRD that defines circuit breaker thresholds for Envoy clusters.
          It can be referenced from a Service using the annotation `cilium.io/circuit-breaker`.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec is the desired state of the CiliumEnvoyCircuitBreaker.
            properties:
              thresholds:
                description: |-
                  Thresholds is a list of circuit breaker thresholds with different priorities.
                  Each threshold defines limits for a specific priority level (DEFAULT or HIGH).
                items:
                  description: CircuitBreakerThreshold defines circuit breaker limits
                    for a specific priority level.
                  properties:
                    maxConnections:
                      description: |-
                        MaxConnections is the maximum number of connections that Envoy can establish
                        to the upstream service. When this threshold is met, new connections will
                        not be established.
                      format: int32
                      type: integer
                    maxPendingRequests:
                      description: |-
                        MaxPendingRequests is the maximum number of pending requests in the queue.
                        When this threshold is met, overflowing requests will be terminated with
                        a 503 status code.
                      format: int32
                      type: integer
                    maxRequests:
                      description: |-
                        MaxRequests is the maximum number of concurrent requests in-flight from
                        Envoy to the upstream service. When this threshold is met, requests will
                        be queued.
                      format: int32
                      type: integer
                    maxRetries:
                      description: |-
                        MaxRetries is the maximum number of retries that can be outstanding to all
                        hosts in a cluster at any given time.
                      format: int32
                      type: integer
                    priority:
                      description: |-
                        Priority specifies the routing priority for this threshold.
                        Valid values are "DEFAULT" and "HIGH".
                      enum:
                      - DEFAULT
                      - HIGH
                      type: string
                  required:
                  - priority
                  type: object
                minItems: 1
                type: array
            required:
            - thresholds
            type: object
        required:
        - metadata
        type: object
    served: true
    storage: true
    subresources: {}
