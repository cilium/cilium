{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    ":gitSignOff",
    "helpers:pinGitHubActionDigests"
  ],
  // Ignore specific presets from config:base that create separate monorepo groups
  // We want all Go dependencies grouped together in all-go-deps-main instead
  "ignorePresets": [
    "group:monorepos",
    "group:recommended",
    "monorepo:aws-sdk-go-v2",
    "monorepo:azure-sdk-for-go",
    "monorepo:opentelemetry-go",
    "group:kubernetes",
    "group:goOpenapi",
    "group:githubArtifactActions"
  ],
  // self-hosted configuration
  "username": "cilium-renovate[bot]",
  "repositories": [
    "cilium/cilium"
  ],
  "prConcurrentLimit": 0,
  "prHourlyLimit": 0,
  // renovate first reads this configuration, then reads the repository
  // configuration, since we don't split between the self-hosted and the
  // repository configuration, this can lead to duplicate of some areas of the
  // config, for example the regex. See:
  // https://docs.renovatebot.com/self-hosted-configuration/#requireconfig
  "requireConfig": "ignored",
  // This ensures that the gitAuthor and gitSignOff fields match
  "gitAuthor": "cilium-renovate[bot] <134692979+cilium-renovate[bot]@users.noreply.github.com>",
  "includePaths": [
    ".github/actions/bpftrace/**",
    ".github/actions/cosign/**",
    ".github/actions/e2e/**",
    ".github/actions/kvstore/**",
    ".github/actions/gather-metrics/**",
    ".github/actions/merge-artifacts/**",
    ".github/actions/post-logic/**",
    ".github/actions/ginkgo/**",
    ".github/actions/lvh-kind/**",
    ".github/actions/set-env-variables/action.yml",
    ".github/actions/ipsec/configs.yaml",
    ".github/workflows/**",
    ".github/ISSUE_TEMPLATE/bug_report.yaml",
    "Documentation/requirements-min/requirements.txt",
    "cilium-cli/**",
    "pkg/azure/**",
    "images/**",
    "examples/hubble/*",
    "go.mod",
    "go.sum",
    "Makefile.defs",
    "test/packet/scripts/install.sh",
    "images/builder/install-protoc.sh",
    "images/builder/install-protoplugins.sh",
    "install/kubernetes/cilium/templates/spire/**",
    "install/kubernetes/cilium/values.yaml.tmpl",
    "install/kubernetes/Makefile.values",
    "test/k8s/manifests/netpol-cyclonus",
    ".custom-gcl.yaml",
  ],
  "schedule": [
    "on sunday"
  ],
  "postUpdateOptions": [
    "gomodTidy"
  ],
  // This ignorePaths configuration option overrides the config:base preset and
  // should not be removed.
  // If removed, we would fall back on the config:base preset, which ignores any
  // paths that match 'examples/*' (which we explicitly do not want to ignore).
  "ignorePaths": [
    // This file is deprecated and no longer present in main
    "images/cilium-test/Dockerfile"
  ],
  "ignoreDeps": [
    // 'google/oss-fuzz' is ignored from the updates because it's currently
    // unversioned and it would be receiving an update every time the upstream
    // repository would receive a new commit.
    "google/oss-fuzz"
  ],
  "pinDigests": true,
  // We don't want to separate major and minor upgrades in separate PRs since
  // we can upgrade them together in a single PR.
  "separateMajorMinor": false,
  // We don't want to separate minor patch upgrades in separate PRs since
  // we can upgrade them together in a single PR.
  "separateMinorPatch": false,
  "pruneStaleBranches": true,
  "baseBranchPatterns": [
    "main",
    "v1.19",
    "v1.18",
    "v1.17"
  ],
  "vulnerabilityAlerts": {
    "enabled": true
  },
  "labels": [
    "renovate/stop-updating",
    "kind/enhancement",
    "release-note/misc"
  ],
  "rebaseLabel": "dont-merge/needs-rebase",
  "stopUpdatingLabel": "renovate/stop-updating",
  "allowedCommands": [
    "^make -C install/kubernetes$",
    "^make -C Documentation update-helm-values$",
    "^make -C Documentation update-cmdref$",
    "^make -C Documentation update-requirements$",
    "^make generate-k8s-api$",
    "^make manifests$",
    "^make GO='contrib/scripts/builder.sh go' generate-apis$",
    "^go mod tidy$",
    "^go mod vendor$"
  ],
  "assignAutomerge": true,
  "packageRules": [
    {
      "matchPackageNames": [
        "bufbuild/buf", // Protocol buffer toolkit
        "docker.io/alpine/socat", // Alpine socat package
        "docker.io/library/busybox", // Official busybox image
        "eksctl-io/eksctl", // EKS CLI tool
        "github/codeql-action", // GitHub CodeQL action
        "go", // golang version directive upgrade in go.mod
        "google/cloud-sdk", // google cloud-sdk official package name
        "google-github-actions/auth", // Google GitHub Actions auth
        "google-github-actions/setup-gcloud", // Google GitHub Actions gcloud setup
        "grpc-ecosystem/grpc-health-probe", // Grpc ecosystem
        "kindest/node", // official kindest images
        "kubernetes/kubernetes", // Kubernetes official releases
        "kubernetes-sigs/kind", // official kind dependencies
        "quay.io/cilium/cilium-envoy", // Cilium's Envoy proxy
        "quay.io/frrouting/frr", // FRRouting package
        "registry.k8s.io/coredns/coredns", // CoreDNS official image
        "renovatebot/github-action", // Renovate's GH action
        "renovatebot/renovate", // Renovate's bot name
        "ghcr.io/renovatebot/renovate", // Renovate's container image
        "actions/{/,}**", // GitHub's official GH actions
        "cilium/{/,}**", // Cilium's GH actions
        "docker.io/library/{/,}**", // official Docker images
        "docker/{/,}**", // official Docker actions
        "gcr.io/distroless{/,}**", // official distroless images
        "gcr.io/etcd-development/etcd{/,}**", // etcd
        "ghcr.io/spiffe/{/,}**", // Spiffe's official images
        "github.com/actions/{/,}**", // GitHub's official GH actions
        "github.com/aws/{/,}**", // Amazon's dependencies
        "github.com/Azure/{/,}**", // Azure's dependencies
        "github.com/cilium/{/,}**", // Any Cilium dependency
        "github.com/docker/{/,}**", // Docker official org
        "github.com/golang/{/,}**", // Golang official org
        "github.com/google/{/,}**", // Google official org
        "github.com/go-openapi/{/,}**", // Open API official org
        "github.com/hashicorp/{/,}**", // Hashicorp's official org
        "github.com/prometheus/{/,}**", // Prometheus's official org
        "go.etcd.io/etcd/{/,}**", // etcd's official org
        "golang.org/x/{/,}**", // Golang official experimental org
        "golangci/golangci-lint{/,}**", // Golang CI linter
        "protocolbuffers/protobuf{/,}**", // protobuf buffers
        "google.golang.org/{/,}**", // Google official repo for api/genproto/grpc/protobuf
        "k8s.io/{/,}**", // Kubernetes official repo
        "quay.io/cilium/{/,}**", // Cilium images
        "quay.io/lvh-images/{/,}**", // LVH images
        "sigs.k8s.io/{/,}**" // Kubernetes official SIG repo
      ],
      "automerge": true,
      "automergeType": "pr",
      "groupName": "auto-merge-trusted-deps",
      // Replace the list of reviewers with just ciliumbot
      "reviewers": [
        "ciliumbot"
      ]
    },
    {
      // Try to group all updates for all dependencies in a single PR. More
      // specific packageRules are followed by this one.
      "matchUpdateTypes": [
        "major",
        "minor",
        "patch",
        "pin",
        "pinDigest",
        "digest",
        "lockFileMaintenance",
        "rollback",
        "bump",
        "replacement"
      ],
      "groupName": "all-dependencies",
      "matchPackageNames": [
        "!quay.io/goswagger/swagger",
        // cilium-envoy is excluded because it has its own grouping rule that
        // combines updates from both dockerfile and regex managers into a single PR.
        "!quay.io/cilium/cilium-envoy"
      ]
    },
    {
      // Update quay.io/goswagger/swagger independently because it changes 300+ files
      // which breaks GitHub workflow path filtering
      "matchPackageNames": [
        "quay.io/goswagger/swagger"
      ],
      "groupName": "goswagger",
      "separateMajorMinor": true,
      "automerge": true,
      "automergeType": "pr",
      // Replace the list of reviewers with just ciliumbot
      "reviewers":[
        "ciliumbot",
      ]
    },
    {
      "groupName": "all github action dependencies",
      "groupSlug": "all-github-action",
      "matchFileNames": [
        ".github/**"
      ]
    },
    {
      "groupName": "all go dependencies main",
      "groupSlug": "all-go-deps-main",
      "matchFileNames": [
        "go.mod",
        "go.sum"
      ],
      "postUpdateOptions": [
        // update source import paths on major updates
        "gomodUpdateImportPaths"
      ],
      "postUpgradeTasks": {
        "commands": [
          "go mod tidy",
          "go mod vendor"
        ],
        "executionMode": "update"
      },
      "matchBaseBranches": [
        "main"
      ]
    },
    {
      // Avoid updating patch releases of golang in go.mod
      "enabled": false,
      "matchFileNames": [
        "go.mod"
      ],
      "matchDepNames": [
        "go"
      ],
      "matchDatasources": [
        "golang-version"
      ],
      "matchUpdateTypes": [
        "patch"
      ],
    },
    {
      // Do not allow any updates into stable branches.
      "enabled": false,
      "groupName": "all go dependencies stable",
      "groupSlug": "all-go-deps-stable",
      "matchFileNames": [
        "go.mod",
        "go.sum"
      ],
      "matchBaseBranches": [
        "!main"
      ]
    },
    {
      "enabled": false,
      "matchPackageNames": [
        "github.com/miekg/dns",
        "github.com/cilium/dns",

        // See https://github.com/cilium/cilium/pull/11607
        "sigs.k8s.io/controller-tools",
        "github.com/cilium/controller-tools",

        // See https://github.com/cilium/cilium/pull/40566
        "github.com/osrg/gobgp/v3",
        "github.com/cilium/gobgp/v3",

        "github.com/cilium/client-go",
        // We update this dependency manually together with envoy proxy updates
        "github.com/cilium/proxy",
        // We update this dependency manually together with conformance test changes
        "sigs.k8s.io/gateway-api",
        // We can't update these libraries until github.com/shoenig/go-m1cpu
        // is added as an exception to the list of licenses into CNCF.
        "/.*google/gops/*/",
        // We can't update these libraries until github.com/shoenig/go-m1cpu
        // is added as an exception to the list of licenses into CNCF.
        "/github.com/shirou/gopsutil/*/",
        // Once we decide to spend cycles on ginkgo v2 we should update the
        // dependency manually.
        "/github.com/onsi/ginkgo/",
        "/github.com/onsi/gomega/*/",
        // We can't update to helm v4 until https://github.com/helm/helm/issues/31525 is fixed
        "helm.sh/helm/*",
        // We can't update it, see https://github.com/cilium/cilium/issues/44063 for more info
        "github.com/cilium/ebpf"
      ]
    },
    {
      // Grouped these together because they require a re-creation of the base
      // image.
      "groupName": "base-images",
      "matchFileNames": [
        "images/builder/Dockerfile",
        "images/runtime/Dockerfile"
      ],
      "matchPackageNames": [
        "docker.io/library/golang",
      ],
    },
    // Do not allow any updates for major.minor on stable release branches to avoid churn from linters.
    {
      enabled: false,
      matchPackageNames: [
        'quay.io/goswagger/swagger',
      ],
      matchBaseBranches: [
        "!main",
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
    },
    {
      "groupName": "all external docker images dependencies",
      "groupSlug": "all-external-images-deps-stable",
      "matchFileNames": [
        "install/kubernetes/Makefile.values"
      ],
      "matchPackageNames": [
        // cilium-envoy is excluded because it has its own grouping rule that
        // combines updates from both dockerfile and regex managers into a single PR.
        "!quay.io/cilium/cilium-envoy"
      ],
      // This is required as otherwise patch version updates into stable branches
      // are also skipped if a minor version update is available at the same time.
      "separateMinorPatch": true,
      "matchBaseBranches": [
        "!main"
      ]
    },
    {
      // Do not allow any major and minor updates into stable branches by default.
      "enabled": false,
      "matchFileNames": [
        "install/kubernetes/Makefile.values"
      ],
      "matchUpdateTypes": [
        "major",
        "minor",
      ],
      matchBaseBranches: [
        "!main",
      ],
      "matchDepNames": [
        // Explicitly allow certgen and cilium-envoy updates.
        "!quay.io/cilium/certgen",
        "!quay.io/cilium/cilium-envoy"
      ]
    },
    {
      "matchPackageNames": [
        "docker.io/library/ubuntu"
      ],
      "allowedVersions": "24.04",
      "matchBaseBranches": [
        "v1.19",
        "v1.18",
        "v1.17",
        "main"
      ]
    },
    {
      "matchPackageNames": [
        "docker.io/library/golang",
        "go"
      ],
      "allowedVersions": "<1.26",
      "matchBaseBranches": [
        "v1.19"
      ]
    },
    {
      "matchPackageNames": [
        "docker.io/library/golang",
        "go"
      ],
      "allowedVersions": "<1.25",
      "matchBaseBranches": [
        "v1.18",
        "v1.17"
      ]
    },
    {
      "matchPackageNames": [
        "docker.io/library/alpine"
      ],
      "allowedVersions": "<3.24",
      "matchBaseBranches": [
        "v1.19"
      ]
    },
    {
      "matchPackageNames": [
        "docker.io/library/alpine"
      ],
      "allowedVersions": "<3.23",
      "matchBaseBranches": [
        "v1.18"
      ]
    },
    {
      "matchPackageNames": [
        "docker.io/library/alpine"
      ],
      "allowedVersions": "<3.20",
      "matchBaseBranches": [
        "v1.17"
      ]
    },
    {
      // Avoid updating patch version for statedb as it might contain breaking changes
      "enabled": false,
      "matchPackageNames": [
        "github.com/cilium/statedb"
      ],
      "matchUpdateTypes": [
        "major",
        "minor",
        "pin",
        "pinDigest",
        "digest",
        "lockFileMaintenance",
        "rollback",
        "bump",
        "replacement"
      ]
    },
    {
      // It's returning 500s for git clones.
      "enabled": false,
      "matchDepNames": [
        "golang.zx2c4.com/wireguard"
      ],
      "versioning": "regex:^v?0\\.0\\.0-(?<patch>\\d+)-.*$"
    },
    {
      // Ref: https://github.com/cilium/cilium-cli#releases
      "groupName": "Cilium CLI",
      "groupSlug": "cilium-cli",
      "matchDepNames": [
        "cilium/cilium-cli"
      ]
    },
    {
      "groupName": "Hubble CLI",
      "groupSlug": "hubble-cli",
      "matchDepNames": [
        "cilium/hubble",
        "quay.io/cilium/hubble"
      ]
    },
    {
      // Group golang version and docker image together for base image updates
      "groupName": "base-images",
      "matchDepNames": [
        "go",
        "docker.io/library/golang"
      ]
    },
    {
      // Group golangci-lint updates to overrule grouping of version updates in the GHA files.
      // Without this, golangci-lint updates are not in sync for GHA files and other usages.
      "groupName": "all-dependencies",
      "matchDepNames": [
        "golangci/golangci-lint",
        "golangci/golangci-lint-action"
      ]
    },
    {
      // Do not allow any updates into stable branches.
      "enabled": false,
      "matchDepNames": [
        "golangci/golangci-lint",
        "golangci/golangci-lint-action"
      ],
      "matchBaseBranches": [
        "!main",
      ]
    },
    {
      "matchDepNames": [
        "quay.io/lvh-images/complexity-test",
        "quay.io/lvh-images/kind"
      ],
      "versioning": "regex:^((?<compatibility>[a-z0-9-.]+)|((?<major>\\d+)\\.(?<minor>\\d+)))\\-(?<patch>\\d+)\\.(?<build>\\d+)(@(?<currentDigest>sha256:[a-f0-9]+))?$"
    },
    {
      "groupName": "stable lvh-images",
      "groupSlug": "stable-lvh-images",
      "matchPackageNames": [
        "cilium/little-vm-helper",
        "quay.io/lvh-images/complexity-test",
        "quay.io/lvh-images/kind"
      ],
      "allowedVersions": "!/bpf-next-.*/",
      "matchBaseBranches": [
        "!main",
      ],
    },
    {
      "groupName": "all lvh-images main",
      "groupSlug": "all-lvh-images-main",
      "matchPackageNames": [
        "cilium/little-vm-helper",
        "quay.io/lvh-images/complexity-test",
        "quay.io/lvh-images/kind"
      ],
      "matchBaseBranches": [
        "main"
      ]
    },
    {
      // group updating renovate versions together (config validator/self hosted renovate)
      "groupName": "all-dependencies",
      "matchDepNames": [
        "renovatebot/renovate",
        "ghcr.io/renovatebot/renovate",
      ],
      "matchBaseBranches": [
        "main"
      ],
    },
    {
      // Separate major minor and patch so that renovate can update the patch
      // versions of the images.
      "matchPackageNames": [
        "quay.io/lvh-images/complexity-test",
        "quay.io/lvh-images/kind",
        "kindest/node",
        "quay.io/cilium/kindest-node"
      ],
      "separateMajorMinor": true,
      "separateMinorPatch": true
    },
    {
      // Do not allow any updates for major.minor, they will be done by maintainers
      "enabled": false,
      "matchPackageNames": [
        "quay.io/lvh-images/complexity-test",
        "quay.io/lvh-images/kind",
        "kindest/node",
        "quay.io/cilium/kindest-node"
      ],
      "matchUpdateTypes": [
        "major",
        "minor"
      ]
    },
    {
      "matchPackageNames": [
        "quay.io/cilium/kindest-node"
      ],
      "ignoreUnstable": false
    },
    {
      "matchFileNames": [
        "install/kubernetes/Makefile.values"
      ],
      "postUpgradeTasks": {
        "commands": [
          "make -C install/kubernetes",
          "make -C Documentation update-helm-values"
        ],
        "fileFilters": [
          "install/kubernetes/Makefile.values",
          "install/kubernetes/cilium/README.md",
          "install/kubernetes/cilium/values.yaml",
          "Documentation/helm-values.rst"
        ],
        "executionMode": "update"
      }
    },
    {
      "matchFileNames": [
        "cilium-cli/defaults/defaults.go"
      ],
      "postUpgradeTasks": {
        "commands": [
          "make -C Documentation update-cmdref"
        ],
        "fileFilters": [
          "Documentation/cmdref/cilium_connectivity_test.md",
          "Documentation/cmdref/cilium_connectivity_perf.md"
        ],
        "executionMode": "update"
      }
    },
    {
      "matchPackageNames": [
        "github.com/cilium/charts"
      ],
      "postUpgradeTasks": {
        "commands": [
          "make -C Documentation update-cmdref"
        ],
        "fileFilters": [
          "Documentation/cmdref/cilium_install.md",
          "Documentation/cmdref/cilium_upgrade.md"
        ],
        "executionMode": "update"
      }
    },
    {
      "matchFileNames": [
        "Documentation/requirements-min/requirements.txt"
      ],
      "pinDigests": false,
      "postUpgradeTasks": {
        "commands": [
          "make -C Documentation update-requirements"
        ],
        "fileFilters": [
          "Documentation/requirements.txt"
        ],
        "executionMode": "update"
      }
    },
    {
      // Only allow minor and patch updates for Documentation dependencies, no major updates
      "enabled": false,
      "matchFileNames": [
        "Documentation/requirements-min/requirements.txt"
      ],
      "matchUpdateTypes": [
        "major"
      ]
    },
    {
      // k8s dependencies will be updated manually along with tests
      "enabled": false,
      "matchUpdateTypes": [
        "major",
        "minor"
      ],
      "matchDepNames": [
        "/k8s.io/*/",
        "/sigs.k8s.io/*/"
      ]
    },
    {
      // Allow k8s.io patch updates on all branches
      // (overrides the "all go dependencies stable" rule)
      "groupName": "auto-merge-trusted-deps",
      "matchDepNames": [
        "/k8s.io/*/",
        "/sigs.k8s.io/*/"
      ],
      "matchUpdateTypes": [
        "patch"
      ],
      "enabled": true
    },
    {
      "matchDepNames": [
        // k8s dependencies will be updated manually along with tests
        "/k8s.io/*/",
        "/sigs.k8s.io/*/"
      ],
      "postUpgradeTasks": {
        "commands": [
          "make generate-k8s-api",
          "make manifests"
        ],
        "executionMode": "update"
      }
    },
    {
      // Grouped these together because they require a re-creation of the base
      // image.
      "groupName": "base-images",
      "matchFileNames": [
        "images/builder/install-protoc.sh",
        "images/builder/install-protoplugins.sh"
      ],
      "postUpgradeTasks": {
        "commands": [
          "make GO='contrib/scripts/builder.sh go' generate-apis"
        ],
        "executionMode": "update"
      }
    },
    {
      "matchPackageNames": [
        "protocolbuffers/protobuf",
        "protocolbuffers/protobuf-go",
        "quay.io/goswagger/swagger"
      ],
      "postUpgradeTasks": {
        "commands": [
          "make GO='contrib/scripts/builder.sh go' generate-apis"
        ],
        "executionMode": "update"
      }
    },
    {
      // Images from the image-tools repository that have a timestamp-based versioning scheme
      // See https://github.com/cilium/image-tools/pull/286
      "matchPackageNames": [
        "quay.io/cilium/image-compilers",
        "quay.io/cilium/image-maker",
        "quay.io/cilium/startup-script",
        "quay.io/cilium/image-tester",
      ],
      "versioning": "regex:^(?<major>\\d+)-[a-f0-9]{7}$"
    },
    {
      // Images from the image-tools repository that have a semantic + timestamp-based versioning scheme
      // See https://github.com/cilium/image-tools/pull/413
      // See each image for an example version tag
      "matchPackageNames": [
        "quay.io/cilium/cilium-bpftool",    // 7.4.0-1758805548-08727cd
        "quay.io/cilium/iptables",          // 1.8.8-1-1758805548-08727cd
        "quay.io/cilium/cilium-llvm",       // 19.1.7-1758805548-08727cd
      ],
      "versioning": "regex:^(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)(-\\d+)?-(?<build>\\d+)-[a-f0-9]{7}$",
    },
    {
      // Images from the image-tools repository that have a semantic (major.minor only) + timestamp-based versioning scheme
      // See https://github.com/cilium/image-tools/pull/413
      // See each image for an example version tag
      "matchPackageNames": [
        "quay.io/cilium/cilium-checkpatch", // 5.12-1755701578-b97bd7a
        "quay.io/cilium/network-perf",      // 3.19-1758616553-aad452d
      ],
      "versioning": "regex:^(?<major>\\d+)\\.(?<minor>\\d+)-(?<patch>\\d+)-[a-f0-9]{7}$",
    },
    {
      // Avoid updating minor or major version for github.com/envoyproxy/go-control-plane/envoy
      // as we need to update cilium-envoy accordingly.
      "matchPackageNames": [
        "github.com/envoyproxy/go-control-plane/envoy",
      ],
      "matchUpdateTypes": [
        "patch",
      ]
    },
    {
      // cilium-envoy is referenced in both images/cilium/Dockerfile and
      // install/kubernetes/Makefile.values. Without explicit grouping,
      // Renovate creates separate PRs for each manager. The groupSlug ensures
      // both updates use the same branch name and get combined into a single
      // PR.
      "groupName": "cilium-envoy",
      "groupSlug": "cilium-envoy",
      "matchDepNames": [
        "quay.io/cilium/cilium-envoy"
      ],
      "versioning": "regex:v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)-(?<build>\\d+).*$",
      "allowedVersions": "/^v1\\.35\\.([0-9]+)-([0-9]+)-.*$/",
      "matchBaseBranches": [
        "v1.19",
        "v1.18",
        "v1.17"
      ]
    },
    {
      // cilium-envoy is referenced in both images/cilium/Dockerfile and
      // install/kubernetes/Makefile.values. Without explicit grouping,
      // Renovate creates separate PRs for each manager. The groupSlug ensures
      // both updates use the same branch name and get combined into a single
      // PR.
      "groupName": "cilium-envoy",
      "groupSlug": "cilium-envoy",
      "matchDepNames": [
        "quay.io/cilium/cilium-envoy"
      ],
      "versioning": "regex:v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)-(?<build>\\d+).*$",
      "allowedVersions": "/^v1\\.36\\.([0-9]+)-([0-9]+)-.*$/",
      "matchBaseBranches": [
        "main",
      ]
    },
    {
      "matchDepNames": [
        "grpc/grpc-go"
      ],
      "versioning": "regex:cmd/protoc-gen-go-grpc/v(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)$"
    },
    {
      "matchPackageNames": [
        "github.com/aliyun/alibaba-cloud-sdk-go",
        "github.com/aws/smithy-go",
        "renovatebot/github-action"
      ],
      "schedule": [
        "on the 1st day instance on sunday"
      ],
      "matchDepNames": [
        "/github.com/Azure/azure-sdk-for-go/sdk/*/",
        "/github.com/aws/aws-sdk-go-v2*/"
      ]
    },
    {
      // Separate major minor and patch so that renovate can update the patch
      // versions of cilium.
      "matchFileNames": [
        ".github/ISSUE_TEMPLATE/bug_report.yaml"
      ],
      "matchDepNames": [
        "cilium/cilium"
      ],
      "separateMajorMinor": true,
      "separateMinorPatch": true,
      "ignoreUnstable": false,
      "versioning": "semver"
    },
    {
      "enabled": false,
      "matchFileNames": [
        ".github/ISSUE_TEMPLATE/bug_report.yaml"
      ],
      "matchDepNames": [
        "cilium/cilium"
      ],
      "matchUpdateTypes": [
        "major",
        "minor"
      ]
    },
    {
      "enabled": false,
      "matchFileNames": [
        ".github/workflows/lint-build-commits.yaml"
      ],
      "matchDepTypes": [
        "github-runner"
      ],
      "matchPackageNames": [
        "ubuntu"
      ],
      "matchUpdateTypes": [
        "major"
      ],
      "matchBaseBranches": [
        "!main",
      ]
    },
    {
      // Separate patch version updates, so that renovate can update the patch
      // versions on stable branches.
      "groupName": "auto-merge-trusted-deps",
      "matchDepNames": [
        "gcr.io/etcd-development/etcd"
      ],
      "separateMinorPatch": true
    },
    {
      // Do not allow any major and minor etcd updates into stable branches.
      "enabled": false,
      "matchDepNames": [
        "gcr.io/etcd-development/etcd"
      ],
      "matchUpdateTypes": [
        "major",
        "minor",
      ],
      "matchBaseBranches": [
        "!main",
      ]
    },
    {
      // Temporarily disable all etcd updates on v1.17, because newer
      // versions are compiled with go 1.24.8 or later, which includes a breaking
      // change in IP addresses parsing affecting the clustermesh-apiserver usage.
      // See cilium/cilium#42818 for more details and the fix, which is intended
      // to be backported once we built up sufficient confidence.
      "enabled": false,
      "matchDepNames": [
        "gcr.io/etcd-development/etcd"
      ],
      "matchBaseBranches": [
        "v1.17"
      ]
    }
  ],
  "kubernetes": {
    "managerFilePatterns": [
      "/examples/hubble/hubble-cli\\.yaml/"
    ]
  },
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/images/builder/install-protoc.sh/",
        "/images/builder/install-protoplugins.sh/",
        "/images/runtime/build-gops.sh/"
      ],
      // These regexes manage version and digest strings in shell scripts,
      // similar to the examples shown here:
      //   https://docs.renovatebot.com/modules/manager/regex/#advanced-capture
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+_version=\"(?<currentValue>.*)\"",
        // The digestVersion in this regex is required for Renovate to be able
        // to match the digest to the pinned version. It will not work without it.
        // Note that for GitHub release artifact digests, you likely want to use
        // github-release-attachments as the datasource here.
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?) digestVersion=(?<currentValue>.*)\\s+.+_sha256.*=\"(?<currentDigest>.*)\"",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s.+@(?<currentValue>.*)",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s.+_VERSION=(?<currentValue>.*)"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/.github/ISSUE_TEMPLATE/bug_report.yaml/"
      ],
      // These regexes manage version and digest strings in shell scripts,
      // similar to the examples shown here:
      //   https://docs.renovatebot.com/modules/manager/regex/#advanced-capture
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+- 'equal or higher than (?<currentValue>.*) and lower than.+"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^\\.github/workflows/[^/]+\\.ya?ml$/",
        "/^\\.github/actions/e2e/[^/]+\\.ya?ml$/",
        "/^\\.github/actions/ginkgo/[^/]+\\.ya?ml$/",
        "/^\\.github/actions/ipsec/[^/]+\\.ya?ml$/"
      ],
      // This regex manages version strings in GitHub actions workflow files,
      // similar to the examples shown here:
      //   https://docs.renovatebot.com/modules/manager/regex/#advanced-capture
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+version: (?<currentValue>.*)",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+_VERSION: (?<currentValue>.*)",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+[\\w.]+:\\s+'(?<currentValue>.*)'",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.*FULL_KERNEL=\"(?<currentValue>.*)\"",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+kernel: '(?<currentValue>.*)'",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*)\\s+.+kernel: \"(?<currentValue>.*)\"",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*)\\s+.+image-version: \"(?<currentValue>.*)\"",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*)\\s+.+lvhImage: \"(?<currentValue>.*)\"",
        "# renovate: datasource=(?<datasource>.*?)\\s+.+kube-image: \"(?<depName>.*):(?<currentValue>.*)@(?<currentDigest>sha256:[a-f0-9]+)\"",
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?) branch=(?<currentValue>.*?)\\s+.+_ref: (?<currentDigest>.*)"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^Makefile\\.defs$/"
      ],
      // This regex manages version strings in the Makefile.defs file,
      // similar to the examples shown here:
      //   https://docs.renovatebot.com/modules/manager/regex/#advanced-capture
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+_VERSION = (?<currentValue>.*)\\s+.+_SHA = (?<currentDigest>sha256:[a-f0-9]+)"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^.github/actions/set-env-variables/action\\.yml$/"
      ],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+_VERSION=\"(?<currentValue>.*)\"",
        "# renovate: datasource=(?<datasource>.*?)\\s+KIND_K8S_IMAGE=\"(?<depName>.*):(?<currentValue>.*)@(?<currentDigest>sha256:[a-f0-9]+)\""
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^.github/workflows/renovate-config-validator\\.yaml$/"
      ],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?)\\s+export RENOVATE_IMAGE=\"?(?<depName>.*):(?<currentValue>.*)@(?<currentDigest>sha256:[a-f0-9]+)\"?"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^go\\.mod$/"
      ],
      "matchStrings": [
        "// renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+go (?<currentValue>.*)"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/.github/actions/kvstore/action.yaml/"
      ],
      "matchStrings": [
        "default: (?<depName>.*?):(?<currentValue>.*?)@(?<currentDigest>.*?)\\s"
      ],
      "datasourceTemplate": "docker"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^install/kubernetes/Makefile\\.values$/"
      ],
      // This regex manages version strings in the Makefile.defs file,
      // similar to the examples shown here:
      //   https://docs.renovatebot.com/modules/manager/regex/#advanced-capture
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?)\\s+.+_REPO:=(?<depName>.*?)\\s+.+_VERSION:=(?<currentValue>.*)\\s+.+_DIGEST:=(?<currentDigest>sha256:[a-f0-9]+)"
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/^cilium-cli/defaults/defaults\\.go$/"
      ],
      "matchStrings": [
        "// renovate: datasource=(?<datasource>.*?)\\s+\"[^\"]+\": \"(?<depName>.*):(?<currentValue>.*)@(?<currentDigest>sha256:[a-f0-9]+)\""
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/.github/actions/lvh-kind/action.yaml/",
        "/.github/workflows/conformance-ginkgo.yaml/",
        "/.github/workflows/conformance-runtime.yaml/",
        "/.github/workflows/tests-datapath-verifier.yaml/"
      ],
      // These regexes manage version and digest strings in shell scripts,
      // similar to the examples shown here:
      //   https://docs.renovatebot.com/modules/manager/regex/#advanced-capture
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+.+lvh-version: \"(?<currentValue>.*)\""
      ]
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/.github/workflows/.*\\.ya?ml$/"
      ],
      "matchStrings": [
        "['\"]ubuntu-(?<currentValue>[0-9]{2}\\.[0-9]{2})['\"]"
      ],
      "datasourceTemplate": "github-runners",
      "depNameTemplate": "ubuntu",
      "packageNameTemplate": "ubuntu"
    },
    {
      "fileMatch": [
        "^\\.custom-gcl\\.yaml$"
      ],
      "matchStrings": [
        "# renovate: datasource=(?<datasource>.*?) depName=(?<depName>.*?)\\s+version:\\s+'?(?<currentValue>[^'\"\\s]+)'?"
      ]
    },
  ]
}
