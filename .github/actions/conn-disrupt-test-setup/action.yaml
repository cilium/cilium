name: Cilium Conn Disrupt Setup
description: Setup cilium connection disruption test

inputs:
  cilium-cli:
    required: false
    default: "./cilium-cli"
    description: 'Path to the Cilium CLI binary'

runs:
  using: composite
  steps:
    - name: Setup Conn Disrupt Test
      shell: bash
      run: |
        # Create pods which establish long lived connections. It will be used by
        # subsequent connectivity tests with --include-conn-disrupt-test to catch any
        # interruption in such flows.
        ${{ inputs.cilium-cli }} connectivity test --include-conn-disrupt-test --conn-disrupt-test-setup \
          --conn-disrupt-dispatch-interval 0ms \
          --expected-xfrm-errors "+inbound_no_state"
